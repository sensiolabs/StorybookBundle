'use strict';

var child_process = require('child_process');
var qe = require('path');
var unplugin = require('unplugin');
var hn = require('html-webpack-plugin');
var nodeLogger = require('@storybook/node-logger');
var jsdom = require('jsdom');
var url = require('url');
var li = require('fs');
var promises = require('fs/promises');
var events = require('events');
var Hs = require('stream');
var string_decoder = require('string_decoder');
var fa = require('crypto');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

function _interopNamespace(e) {
  if (e && e.__esModule) return e;
  var n = Object.create(null);
  if (e) {
    Object.keys(e).forEach(function (k) {
      if (k !== 'default') {
        var d = Object.getOwnPropertyDescriptor(e, k);
        Object.defineProperty(n, k, d.get ? d : {
          enumerable: true,
          get: function () { return e[k]; }
        });
      }
    });
  }
  n.default = e;
  return Object.freeze(n);
}

var qe__default = /*#__PURE__*/_interopDefault(qe);
var hn__default = /*#__PURE__*/_interopDefault(hn);
var li__namespace = /*#__PURE__*/_interopNamespace(li);
var Hs__default = /*#__PURE__*/_interopDefault(Hs);
var fa__default = /*#__PURE__*/_interopDefault(fa);

var Ki=Object.create;var Xe=Object.defineProperty;var Zi=Object.getOwnPropertyDescriptor;var Ji=Object.getOwnPropertyNames;var Qi=Object.getPrototypeOf,tn=Object.prototype.hasOwnProperty;var mt=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});var C=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var en=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ji(t))!tn.call(s,n)&&n!==e&&Xe(s,n,{get:()=>t[n],enumerable:!(i=Zi(t,n))||i.enumerable});return s};var zt=(s,t,e)=>(e=s!=null?Ki(Qi(s)):{},en(t||!s||!s.__esModule?Xe(e,"default",{value:s,enumerable:!0}):e,s));var ss=C(ot=>{var cn=ot&&ot.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ot,"__esModule",{value:!0});ot.VirtualStats=void 0;var J=cn(mt("constants")),pe=class{constructor(t){for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this[e]=t[e]);}_checkModeProperty(t){return (this.mode&J.default.S_IFMT)===t}isDirectory(){return this._checkModeProperty(J.default.S_IFDIR)}isFile(){return this._checkModeProperty(J.default.S_IFREG)}isBlockDevice(){return this._checkModeProperty(J.default.S_IFBLK)}isCharacterDevice(){return this._checkModeProperty(J.default.S_IFCHR)}isSymbolicLink(){return this._checkModeProperty(J.default.S_IFLNK)}isFIFO(){return this._checkModeProperty(J.default.S_IFIFO)}isSocket(){return this._checkModeProperty(J.default.S_IFSOCK)}};ot.VirtualStats=pe;});var os=C((ye,rs)=>{var fn=ye&&ye.__importDefault||function(s){return s&&s.__esModule?s:{default:s}},Ht=fn(mt("path")),is=ss(),ns=45e6,ge="all",un="static",dn="dynamic";function pn(s){if(!s._compiler)throw new Error("You must use this plugin only after creating webpack instance!")}function gn(s,t){return Ht.default.isAbsolute(s)?s:Ht.default.join(t.context,s)}function wt(s){return t=>{if(t._data){let e=t._currentLevel,i=t._levels[e];return {result:s,level:i}}return [null,s]}}function mn(s,t){return s._data instanceof Map?s._data.get(t):s._data?s.data[t]:s.data instanceof Map?s.data.get(t):s.data[t]}function yt(s,t,e){let i=e(s);s._data instanceof Map?s._data.set(t,i):s._data?s.data[t]=i:s.data instanceof Map?s.data.set(t,i):s.data[t]=i;}function wn(s){if(s._statStorage)return s._statStorage;if(s._statBackend)return s._statBackend;throw new Error("Couldn't find a stat storage")}function yn(s){if(s._readFileStorage)return s._readFileStorage;if(s._readFileBackend)return s._readFileBackend;throw new Error("Couldn't find a readFileStorage")}function me(s){if(s._readdirBackend)return s._readdirBackend;if(s._readdirStorage)return s._readdirStorage;throw new Error("Couldn't find a readDirStorage from Webpack Internals")}var we=class{constructor(t){this._compiler=null,this._watcher=null,this._staticModules=t||null;}getModuleList(t=ge){var e,i;let n={},r=t===ge||t===un,o=t===ge||t===dn;if(r&&(n=Object.assign(Object.assign({},n),this._staticModules)),o){let h=(e=this._compiler)===null||e===void 0?void 0:e.inputFileSystem,a=(i=h?._virtualFiles)!==null&&i!==void 0?i:{},l={};Object.keys(a).forEach(c=>{l[c]=a[c].contents;}),n=Object.assign(Object.assign({},n),l);}return n}writeModule(t,e){if(!this._compiler)throw new Error("Plugin has not been initialized");pn(this);let i=e?e.length:0,n=Date.now(),r=new Date(n),o=new is.VirtualStats({dev:8675309,nlink:0,uid:1e3,gid:1e3,rdev:0,blksize:4096,ino:ns++,mode:33188,size:i,blocks:Math.floor(i/4096),atime:r,mtime:r,ctime:r,birthtime:r}),h=gn(t,this._compiler);process.env.WVM_DEBUG&&console.log(this._compiler.name,"Write virtual module:",h,e);let a=this._watcher&&this._watcher.watchFileSystem;for(;a&&a.wfs;)a=a.wfs;let l=this._compiler.inputFileSystem;for(;l&&l._inputFileSystem;)l=l._inputFileSystem;if(l._writeVirtualFile(h,o,e),a&&a.watcher&&(a.watcher.fileWatchers.size||a.watcher.fileWatchers.length)){let c=a.watcher.fileWatchers instanceof Map?Array.from(a.watcher.fileWatchers.values()):a.watcher.fileWatchers;for(let f of c)"watcher"in f&&(f=f.watcher),f.path===h&&(process.env.DEBUG&&console.log(this._compiler.name,"Emit file change:",h,n),delete f.directoryWatcher._cachedTimeInfoEntries,f.emit("change",n,null));}}apply(t){this._compiler=t;let e=()=>{let o=t.inputFileSystem;for(;o&&o._inputFileSystem;)o=o._inputFileSystem;if(!o._writeVirtualFile){let h=o.purge;o.purge=()=>{h.apply(o,[]),o._virtualFiles&&Object.keys(o._virtualFiles).forEach(a=>{let l=o._virtualFiles[a];o._writeVirtualFile(a,l.stats,l.contents);});},o._writeVirtualFile=(a,l,c)=>{let f=wn(o),u=yn(o),d=me(o);o._virtualFiles=o._virtualFiles||{},o._virtualFiles[a]={stats:l,contents:c},yt(f,a,wt(l)),yt(u,a,wt(c));let g=a.split(/[\\/]/),p=g.length-1,w=g[0]?1:0;for(;p>w;){let m=g.slice(0,p).join(Ht.default.sep)||Ht.default.sep;try{o.readdirSync(m);}catch{let S=Date.now(),v=new is.VirtualStats({dev:8675309,nlink:0,uid:1e3,gid:1e3,rdev:0,blksize:4096,ino:ns++,mode:16877,size:l.size,blocks:Math.floor(l.size/4096),atime:S,mtime:S,ctime:S,birthtime:S});yt(d,m,wt([])),yt(f,m,wt(v));}let b=mn(me(o),m);b=b[1]||b.result;let E=g[p];if(b.indexOf(E)<0){let y=b.concat([E]).sort();yt(me(o),m,wt(y));}else break;p--;}};}},i=()=>{if(this._staticModules){for(let[o,h]of Object.entries(this._staticModules))this.writeModule(o,h);this._staticModules=null;}},n=typeof t.webpack>"u"?4:5,r=(o,h)=>{this._watcher=o.compiler||o;let a=t.inputFileSystem._virtualFiles,l=t.fileTimestamps;a&&l&&typeof l.set=="function"&&Object.keys(a).forEach(c=>{let f=+a[c].stats.mtime;l.set(c,n===4?f:{safeTime:f,timestamp:f});}),h();};t.hooks?(t.hooks.afterEnvironment.tap("VirtualModulesPlugin",e),t.hooks.afterResolvers.tap("VirtualModulesPlugin",i),t.hooks.watchRun.tapAsync("VirtualModulesPlugin",r)):(t.plugin("after-environment",e),t.plugin("after-resolvers",i),t.plugin("watch-run",r));}};rs.exports=we;});var hs=C((ka,as)=>{as.exports=function(t){if(typeof t!="string"||t==="")return !1;for(var e;e=/(\\).|([@?!+*]\(.*\))/g.exec(t);){if(e[2])return !0;t=t.slice(e.index+e[0].length);}return !1};});var fs=C((Pa,cs)=>{var bn=hs(),ls={"{":"}","(":")","[":"]"},En=function(s){if(s[0]==="!")return !0;for(var t=0,e=-2,i=-2,n=-2,r=-2,o=-2;t<s.length;){if(s[t]==="*"||s[t+1]==="?"&&/[\].+)]/.test(s[t])||i!==-1&&s[t]==="["&&s[t+1]!=="]"&&(i<t&&(i=s.indexOf("]",t)),i>t&&(o===-1||o>i||(o=s.indexOf("\\",t),o===-1||o>i)))||n!==-1&&s[t]==="{"&&s[t+1]!=="}"&&(n=s.indexOf("}",t),n>t&&(o=s.indexOf("\\",t),o===-1||o>n))||r!==-1&&s[t]==="("&&s[t+1]==="?"&&/[:!=]/.test(s[t+2])&&s[t+3]!==")"&&(r=s.indexOf(")",t),r>t&&(o=s.indexOf("\\",t),o===-1||o>r))||e!==-1&&s[t]==="("&&s[t+1]!=="|"&&(e<t&&(e=s.indexOf("|",t)),e!==-1&&s[e+1]!==")"&&(r=s.indexOf(")",e),r>e&&(o=s.indexOf("\\",e),o===-1||o>r))))return !0;if(s[t]==="\\"){var h=s[t+1];t+=2;var a=ls[h];if(a){var l=s.indexOf(a,t);l!==-1&&(t=l+1);}if(s[t]==="!")return !0}else t++;}return !1},Sn=function(s){if(s[0]==="!")return !0;for(var t=0;t<s.length;){if(/[*?{}()[\]]/.test(s[t]))return !0;if(s[t]==="\\"){var e=s[t+1];t+=2;var i=ls[e];if(i){var n=s.indexOf(i,t);n!==-1&&(t=n+1);}if(s[t]==="!")return !0}else t++;}return !1};cs.exports=function(t,e){if(typeof t!="string"||t==="")return !1;if(bn(t))return !0;var i=En;return e&&e.strict===!1&&(i=Sn),i(t)};});var ms=C((Fa,gs)=>{gs.exports=ds;function ds(s,t,e){s instanceof RegExp&&(s=us(s,e)),t instanceof RegExp&&(t=us(t,e));var i=ps(s,t,e);return i&&{start:i[0],end:i[1],pre:e.slice(0,i[0]),body:e.slice(i[0]+s.length,i[1]),post:e.slice(i[1]+t.length)}}function us(s,t){var e=t.match(s);return e?e[0]:null}ds.range=ps;function ps(s,t,e){var i,n,r,o,h,a=e.indexOf(s),l=e.indexOf(t,a+1),c=a;if(a>=0&&l>0){if(s===t)return [a,l];for(i=[],r=e.length;c>=0&&!h;)c==a?(i.push(c),a=e.indexOf(s,c+1)):i.length==1?h=[i.pop(),l]:(n=i.pop(),n<r&&(r=n,o=l),l=e.indexOf(t,c+1)),c=a<l&&a>=0?a:l;i.length&&(h=[r,o]);}return h}});var Ns=C((Ra,Ts)=>{var ws=ms();Ts.exports=Nn;var ys="\0SLASH"+Math.random()+"\0",bs="\0OPEN"+Math.random()+"\0",Ee="\0CLOSE"+Math.random()+"\0",Es="\0COMMA"+Math.random()+"\0",Ss="\0PERIOD"+Math.random()+"\0";function be(s){return parseInt(s,10)==s?parseInt(s,10):s.charCodeAt(0)}function vn(s){return s.split("\\\\").join(ys).split("\\{").join(bs).split("\\}").join(Ee).split("\\,").join(Es).split("\\.").join(Ss)}function Tn(s){return s.split(ys).join("\\").split(bs).join("{").split(Ee).join("}").split(Es).join(",").split(Ss).join(".")}function vs(s){if(!s)return [""];var t=[],e=ws("{","}",s);if(!e)return s.split(",");var i=e.pre,n=e.body,r=e.post,o=i.split(",");o[o.length-1]+="{"+n+"}";var h=vs(r);return r.length&&(o[o.length-1]+=h.shift(),o.push.apply(o,h)),t.push.apply(t,o),t}function Nn(s){return s?(s.substr(0,2)==="{}"&&(s="\\{\\}"+s.substr(2)),bt(vn(s),!0).map(Tn)):[]}function xn(s){return "{"+s+"}"}function Cn(s){return /^-?0\d/.test(s)}function An(s,t){return s<=t}function On(s,t){return s>=t}function bt(s,t){var e=[],i=ws("{","}",s);if(!i)return [s];var n=i.pre,r=i.post.length?bt(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<r.length;o++){var h=n+"{"+i.body+"}"+r[o];e.push(h);}else {var a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),c=a||l,f=i.body.indexOf(",")>=0;if(!c&&!f)return i.post.match(/,.*\}/)?(s=i.pre+"{"+i.body+Ee+i.post,bt(s)):[s];var u;if(c)u=i.body.split(/\.\./);else if(u=vs(i.body),u.length===1&&(u=bt(u[0],!1).map(xn),u.length===1))return r.map(function($t){return i.pre+u[0]+$t});var d;if(c){var g=be(u[0]),p=be(u[1]),w=Math.max(u[0].length,u[1].length),m=u.length==3?Math.abs(be(u[2])):1,b=An,E=p<g;E&&(m*=-1,b=On);var y=u.some(Cn);d=[];for(var S=g;b(S,p);S+=m){var v;if(l)v=String.fromCharCode(S),v==="\\"&&(v="");else if(v=String(S),y){var z=w-v.length;if(z>0){var Bt=new Array(z+1).join("0");S<0?v="-"+Bt+v.slice(1):v=Bt+v;}}d.push(v);}}else {d=[];for(var D=0;D<u.length;D++)d.push.apply(d,bt(u[D],!1));}for(var D=0;D<d.length;D++)for(var o=0;o<r.length;o++){var h=n+d[D]+r[o];(!t||c||h)&&e.push(h);}}return e}});var fe=C(Z=>{var pi=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",to=pi+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",gi="["+pi+"]["+to+"]*",eo=new RegExp("^"+gi+"$"),so=function(s,t){let e=[],i=t.exec(s);for(;i;){let n=[];n.startIndex=t.lastIndex-i[0].length;let r=i.length;for(let o=0;o<r;o++)n.push(i[o]);e.push(n),i=t.exec(s);}return e},io=function(s){let t=eo.exec(s);return !(t===null||typeof t>"u")};Z.isExist=function(s){return typeof s<"u"};Z.isEmptyObject=function(s){return Object.keys(s).length===0};Z.merge=function(s,t,e){if(t){let i=Object.keys(t),n=i.length;for(let r=0;r<n;r++)e==="strict"?s[i[r]]=[t[i[r]]]:s[i[r]]=t[i[r]];}};Z.getValue=function(s){return Z.isExist(s)?s:""};Z.isName=io;Z.getAllMatches=so;Z.nameRegexp=gi;});var $e=C(Ei=>{var Be=fe(),no={allowBooleanAttributes:!1,unpairedTags:[]};Ei.validate=function(s,t){t=Object.assign({},no,t);let e=[],i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=wi(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=yi(s,r);continue}else {let h=!1;s[r]==="/"&&(h=!0,r++);let a="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)a+=s[r];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),r--),!uo(a)){let f;return a.trim().length===0?f="Invalid space after '<'.":f="Tag '"+a+"' is an invalid name.",x("InvalidTag",f,M(s,r))}let l=ao(s,r);if(l===!1)return x("InvalidAttr","Attributes for '"+a+"' have open quote.",M(s,r));let c=l.value;if(r=l.index,c[c.length-1]==="/"){let f=r-c.length;c=c.substring(0,c.length-1);let u=bi(c,t);if(u===!0)i=!0;else return x(u.err.code,u.err.msg,M(s,f+u.err.line))}else if(h)if(l.tagClosed){if(c.trim().length>0)return x("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",M(s,o));{let f=e.pop();if(a!==f.tagName){let u=M(s,f.tagStartPos);return x("InvalidTag","Expected closing tag '"+f.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+a+"'.",M(s,o))}e.length==0&&(n=!0);}}else return x("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",M(s,r));else {let f=bi(c,t);if(f!==!0)return x(f.err.code,f.err.msg,M(s,r-c.length+f.err.line));if(n===!0)return x("InvalidXml","Multiple possible root nodes found.",M(s,r));t.unpairedTags.indexOf(a)!==-1||e.push({tagName:a,tagStartPos:o}),i=!0;}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=yi(s,r);continue}else if(s[r+1]==="?"){if(r=wi(s,++r),r.err)return r}else break;else if(s[r]==="&"){let f=co(s,r);if(f==-1)return x("InvalidChar","char '&' is not expected.",M(s,r));r=f;}else if(n===!0&&!mi(s[r]))return x("InvalidXml","Extra text at the end",M(s,r));s[r]==="<"&&r--;}}else {if(mi(s[r]))continue;return x("InvalidChar","char '"+s[r]+"' is not expected.",M(s,r))}if(i){if(e.length==1)return x("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",M(s,e[0].tagStartPos));if(e.length>0)return x("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return x("InvalidXml","Start tag expected.",1);return !0};function mi(s){return s===" "||s==="	"||s===`
`||s==="\r"}function wi(s,t){let e=t;for(;t<s.length;t++)if(s[t]=="?"||s[t]==" "){let i=s.substr(e,t-e);if(t>5&&i==="xml")return x("InvalidXml","XML declaration allowed only at the start of the document.",M(s,t));if(s[t]=="?"&&s[t+1]==">"){t++;break}else continue}return t}function yi(s,t){if(s.length>t+5&&s[t+1]==="-"&&s[t+2]==="-"){for(t+=3;t<s.length;t++)if(s[t]==="-"&&s[t+1]==="-"&&s[t+2]===">"){t+=2;break}}else if(s.length>t+8&&s[t+1]==="D"&&s[t+2]==="O"&&s[t+3]==="C"&&s[t+4]==="T"&&s[t+5]==="Y"&&s[t+6]==="P"&&s[t+7]==="E"){let e=1;for(t+=8;t<s.length;t++)if(s[t]==="<")e++;else if(s[t]===">"&&(e--,e===0))break}else if(s.length>t+9&&s[t+1]==="["&&s[t+2]==="C"&&s[t+3]==="D"&&s[t+4]==="A"&&s[t+5]==="T"&&s[t+6]==="A"&&s[t+7]==="["){for(t+=8;t<s.length;t++)if(s[t]==="]"&&s[t+1]==="]"&&s[t+2]===">"){t+=2;break}}return t}var ro='"',oo="'";function ao(s,t){let e="",i="",n=!1;for(;t<s.length;t++){if(s[t]===ro||s[t]===oo)i===""?i=s[t]:i!==s[t]||(i="");else if(s[t]===">"&&i===""){n=!0;break}e+=s[t];}return i!==""?!1:{value:e,index:t,tagClosed:n}}var ho=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function bi(s,t){let e=Be.getAllMatches(s,ho),i={};for(let n=0;n<e.length;n++){if(e[n][1].length===0)return x("InvalidAttr","Attribute '"+e[n][2]+"' has no space in starting.",jt(e[n]));if(e[n][3]!==void 0&&e[n][4]===void 0)return x("InvalidAttr","Attribute '"+e[n][2]+"' is without value.",jt(e[n]));if(e[n][3]===void 0&&!t.allowBooleanAttributes)return x("InvalidAttr","boolean attribute '"+e[n][2]+"' is not allowed.",jt(e[n]));let r=e[n][2];if(!fo(r))return x("InvalidAttr","Attribute '"+r+"' is an invalid name.",jt(e[n]));if(!i.hasOwnProperty(r))i[r]=1;else return x("InvalidAttr","Attribute '"+r+"' is repeated.",jt(e[n]))}return !0}function lo(s,t){let e=/\d/;for(s[t]==="x"&&(t++,e=/[\da-fA-F]/);t<s.length;t++){if(s[t]===";")return t;if(!s[t].match(e))break}return -1}function co(s,t){if(t++,s[t]===";")return -1;if(s[t]==="#")return t++,lo(s,t);let e=0;for(;t<s.length;t++,e++)if(!(s[t].match(/\w/)&&e<20)){if(s[t]===";")break;return -1}return t}function x(s,t,e){return {err:{code:s,msg:t,line:e.line||e,col:e.col}}}function fo(s){return Be.isName(s)}function uo(s){return Be.isName(s)}function M(s,t){let e=s.substring(0,t).split(/\r?\n/);return {line:e.length,col:e[e.length-1].length+1}}function jt(s){return s.startIndex+s[1].length}});var vi=C(ze=>{var Si={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,t,e){return s}},po=function(s){return Object.assign({},Si,s)};ze.buildOptions=po;ze.defaultOptions=Si;});var Ni=C((sl,Ti)=>{var Ue=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={};}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e});}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child});}};Ti.exports=Ue;});var Ci=C((il,xi)=>{var go=fe();function mo(s,t){let e={};if(s[t+3]==="O"&&s[t+4]==="C"&&s[t+5]==="T"&&s[t+6]==="Y"&&s[t+7]==="P"&&s[t+8]==="E"){t=t+9;let i=1,n=!1,r=!1,o="";for(;t<s.length;t++)if(s[t]==="<"&&!r){if(n&&bo(s,t))t+=7,[entityName,val,t]=wo(s,t+1),val.indexOf("&")===-1&&(e[To(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Eo(s,t))t+=8;else if(n&&So(s,t))t+=8;else if(n&&vo(s,t))t+=9;else if(yo)r=!0;else throw new Error("Invalid DOCTYPE");i++,o="";}else if(s[t]===">"){if(r?s[t-1]==="-"&&s[t-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[t]==="["?n=!0:o+=s[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return {entities:e,i:t}}function wo(s,t){let e="";for(;t<s.length&&s[t]!=="'"&&s[t]!=='"';t++)e+=s[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=s[t++],n="";for(;t<s.length&&s[t]!==i;t++)n+=s[t];return [e,n,t]}function yo(s,t){return s[t+1]==="!"&&s[t+2]==="-"&&s[t+3]==="-"}function bo(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="N"&&s[t+4]==="T"&&s[t+5]==="I"&&s[t+6]==="T"&&s[t+7]==="Y"}function Eo(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="L"&&s[t+4]==="E"&&s[t+5]==="M"&&s[t+6]==="E"&&s[t+7]==="N"&&s[t+8]==="T"}function So(s,t){return s[t+1]==="!"&&s[t+2]==="A"&&s[t+3]==="T"&&s[t+4]==="T"&&s[t+5]==="L"&&s[t+6]==="I"&&s[t+7]==="S"&&s[t+8]==="T"}function vo(s,t){return s[t+1]==="!"&&s[t+2]==="N"&&s[t+3]==="O"&&s[t+4]==="T"&&s[t+5]==="A"&&s[t+6]==="T"&&s[t+7]==="I"&&s[t+8]==="O"&&s[t+9]==="N"}function To(s){if(go.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}xi.exports=mo;});var Oi=C((nl,Ai)=>{var No=/^[-+]?0x[a-fA-F0-9]+$/,xo=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var Co={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Ao(s,t={}){if(t=Object.assign({},Co,t),!s||typeof s!="string")return s;let e=s.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return s;if(t.hex&&No.test(e))return Number.parseInt(e,16);{let i=xo.exec(e);if(i){let n=i[1],r=i[2],o=Oo(i[3]),h=i[4]||i[6];if(!t.leadingZeros&&r.length>0&&n&&e[2]!==".")return s;if(!t.leadingZeros&&r.length>0&&!n&&e[1]!==".")return s;{let a=Number(e),l=""+a;return l.search(/[eE]/)!==-1||h?t.eNotation?a:s:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:s:r?o===l||n+o===l?a:s:e===l||e===n+l?a:s}}else return s}}function Oo(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}Ai.exports=Ao;});var Pi=C((rl,ki)=>{var _i=fe(),Wt=Ni(),_o=Ci(),ko=Oi(),Ge=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=Po,this.parseXml=Lo,this.parseTextData=Fo,this.resolveNameSpace=Ro,this.buildAttributesMap=Mo,this.isItStopNode=$o,this.replaceEntitiesValue=Wo,this.readStopNodeData=Uo,this.saveTextToParentTag=Bo,this.addChild=jo;}};function Po(s){let t=Object.keys(s);for(let e=0;e<t.length;e++){let i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]};}}function Fo(s,t,e,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));let h=this.options.tagValueProcessor(t,s,e,n,r);return h==null?s:typeof h!=typeof s||h!==s?h:this.options.trimValues?He(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?He(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function Ro(s){if(this.options.removeNSPrefix){let t=s.split(":"),e=s.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return "";t.length===2&&(s=e+t[1]);}return s}var Io=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Mo(s,t,e){if(!this.options.ignoreAttributes&&typeof s=="string"){let i=_i.getAllMatches(s,Io),n=i.length,r={};for(let o=0;o<n;o++){let h=this.resolveNameSpace(i[o][1]),a=i[o][4],l=this.options.attributeNamePrefix+h;if(h.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);let c=this.options.attributeValueProcessor(h,a,t);c==null?r[l]=a:typeof c!=typeof a||c!==a?r[l]=c:r[l]=He(a,this.options.parseAttributeValue,this.options.numberParseOptions);}else this.options.allowBooleanAttributes&&(r[l]=!0);}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){let o={};return o[this.options.attributesGroupName]=r,o}return r}}var Lo=function(s){s=s.replace(/\r\n?/g,`
`);let t=new Wt("!xml"),e=t,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){let h=rt(s,">",r,"Closing Tag is not closed."),a=s.substring(r+2,h).trim();if(this.options.removeNSPrefix){let f=a.indexOf(":");f!==-1&&(a=a.substr(f+1));}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(i=this.saveTextToParentTag(i,e,n));let l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=n.lastIndexOf("."),n=n.substring(0,c),e=this.tagsNodeStack.pop(),i="",r=h;}else if(s[r+1]==="?"){let h=Ve(s,r,!1,"?>");if(!h)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,n),!(this.options.ignoreDeclaration&&h.tagName==="?xml"||this.options.ignorePiTags)){let a=new Wt(h.tagName);a.add(this.options.textNodeName,""),h.tagName!==h.tagExp&&h.attrExpPresent&&(a[":@"]=this.buildAttributesMap(h.tagExp,n,h.tagName)),this.addChild(e,a,n);}r=h.closeIndex+1;}else if(s.substr(r+1,3)==="!--"){let h=rt(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){let a=s.substring(r+4,h-2);i=this.saveTextToParentTag(i,e,n),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}]);}r=h;}else if(s.substr(r+1,2)==="!D"){let h=_o(s,r);this.docTypeEntities=h.entities,r=h.i;}else if(s.substr(r+1,2)==="!["){let h=rt(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,h);i=this.saveTextToParentTag(i,e,n);let l=this.parseTextData(a,e.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=h+2;}else {let h=Ve(s,r,this.options.removeNSPrefix),a=h.tagName,l=h.rawTagName,c=h.tagExp,f=h.attrExpPresent,u=h.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,n,!1));let d=e;if(d&&this.options.unpairedTags.indexOf(d.tagname)!==-1&&(e=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let g="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)r=h.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=h.closeIndex;else {let w=this.readStopNodeData(s,l,u+1);if(!w)throw new Error(`Unexpected end of ${l}`);r=w.i,g=w.tagContent;}let p=new Wt(a);a!==c&&f&&(p[":@"]=this.buildAttributesMap(c,n,a)),g&&(g=this.parseTextData(g,a,n,!0,f,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),p.add(this.options.textNodeName,g),this.addChild(e,p,n);}else {if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));let g=new Wt(a);a!==c&&f&&(g[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,g,n),n=n.substr(0,n.lastIndexOf("."));}else {let g=new Wt(a);this.tagsNodeStack.push(e),a!==c&&f&&(g[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,g,n),e=g;}i="",r=u;}}else i+=s[r];return t.child};function jo(s,t,e){let i=this.options.updateTag(t.tagname,e,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),s.addChild(t));}var Wo=function(s){if(this.options.processEntities){for(let t in this.docTypeEntities){let e=this.docTypeEntities[t];s=s.replace(e.regx,e.val);}for(let t in this.lastEntities){let e=this.lastEntities[t];s=s.replace(e.regex,e.val);}if(this.options.htmlEntities)for(let t in this.htmlEntities){let e=this.htmlEntities[t];s=s.replace(e.regex,e.val);}s=s.replace(this.ampEntity.regex,this.ampEntity.val);}return s};function Bo(s,t,e,i){return s&&(i===void 0&&(i=Object.keys(t.child).length===0),s=this.parseTextData(s,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&t.add(this.options.textNodeName,s),s=""),s}function $o(s,t,e){let i="*."+e;for(let n in s){let r=s[n];if(i===r||t===r)return !0}return !1}function zo(s,t,e=">"){let i,n="";for(let r=t;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0])if(e[1]){if(s[r+1]===e[1])return {data:n,index:r}}else return {data:n,index:r};else o==="	"&&(o=" ");n+=o;}}function rt(s,t,e,i){let n=s.indexOf(t,e);if(n===-1)throw new Error(i);return n+t.length-1}function Ve(s,t,e,i=">"){let n=zo(s,t+1,i);if(!n)return;let r=n.data,o=n.index,h=r.search(/\s/),a=r,l=!0;h!==-1&&(a=r.substring(0,h),r=r.substring(h+1).trimStart());let c=a;if(e){let f=a.indexOf(":");f!==-1&&(a=a.substr(f+1),l=a!==n.data.substr(f+1));}return {tagName:a,tagExp:r,closeIndex:o,attrExpPresent:l,rawTagName:c}}function Uo(s,t,e){let i=e,n=1;for(;e<s.length;e++)if(s[e]==="<")if(s[e+1]==="/"){let r=rt(s,">",e,`${t} is not closed`);if(s.substring(e+2,r).trim()===t&&(n--,n===0))return {tagContent:s.substring(i,e),i:r};e=r;}else if(s[e+1]==="?")e=rt(s,"?>",e+1,"StopNode is not closed.");else if(s.substr(e+1,3)==="!--")e=rt(s,"-->",e+3,"StopNode is not closed.");else if(s.substr(e+1,2)==="![")e=rt(s,"]]>",e,"StopNode is not closed.")-2;else {let r=Ve(s,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,e=r.closeIndex);}}function He(s,t,e){if(t&&typeof s=="string"){let i=s.trim();return i==="true"?!0:i==="false"?!1:ko(s,e)}else return _i.isExist(s)?s:""}ki.exports=Ge;});var Ii=C(Ri=>{function Go(s,t){return Fi(s,t)}function Fi(s,t,e){let i,n={};for(let r=0;r<s.length;r++){let o=s[r],h=Vo(o),a="";if(e===void 0?a=h:a=e+"."+h,h===t.textNodeName)i===void 0?i=o[h]:i+=""+o[h];else {if(h===void 0)continue;if(o[h]){let l=Fi(o[h],t,a),c=Do(l,t);o[":@"]?Ho(l,o[":@"],a,t):Object.keys(l).length===1&&l[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?l=l[t.textNodeName]:Object.keys(l).length===0&&(t.alwaysCreateTextNode?l[t.textNodeName]="":l=""),n[h]!==void 0&&n.hasOwnProperty(h)?(Array.isArray(n[h])||(n[h]=[n[h]]),n[h].push(l)):t.isArray(h,a,c)?n[h]=[l]:n[h]=l;}}}return typeof i=="string"?i.length>0&&(n[t.textNodeName]=i):i!==void 0&&(n[t.textNodeName]=i),n}function Vo(s){let t=Object.keys(s);for(let e=0;e<t.length;e++){let i=t[e];if(i!==":@")return i}}function Ho(s,t,e,i){if(t){let n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){let h=n[o];i.isArray(h,e+"."+h,!0,!0)?s[h]=[t[h]]:s[h]=t[h];}}}function Do(s,t){let{textNodeName:e}=t,i=Object.keys(s).length;return !!(i===0||i===1&&(s[e]||typeof s[e]=="boolean"||s[e]===0))}Ri.prettify=Go;});var Li=C((al,Mi)=>{var{buildOptions:qo}=vi(),Xo=Pi(),{prettify:Yo}=Ii(),Ko=$e(),De=class{constructor(t){this.externalEntities={},this.options=qo(t);}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});let r=Ko.validate(t,e);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}let i=new Xo(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(t);return this.options.preserveOrder||n===void 0?n:Yo(n,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e;}};Mi.exports=De;});var zi=C((hl,$i)=>{var Zo=`
`;function Jo(s,t){let e="";return t.format&&t.indentBy.length>0&&(e=Zo),Wi(s,t,"",e)}function Wi(s,t,e,i){let n="",r=!1;for(let o=0;o<s.length;o++){let h=s[o],a=Qo(h);if(a===void 0)continue;let l="";if(e.length===0?l=a:l=`${e}.${a}`,a===t.textNodeName){let g=h[a];ta(l,t)||(g=t.tagValueProcessor(a,g),g=Bi(g,t)),r&&(n+=i),n+=g,r=!1;continue}else if(a===t.cdataPropName){r&&(n+=i),n+=`<![CDATA[${h[a][0][t.textNodeName]}]]>`,r=!1;continue}else if(a===t.commentPropName){n+=i+`<!--${h[a][0][t.textNodeName]}-->`,r=!0;continue}else if(a[0]==="?"){let g=ji(h[":@"],t),p=a==="?xml"?"":i,w=h[a][0][t.textNodeName];w=w.length!==0?" "+w:"",n+=p+`<${a}${w}${g}?>`,r=!0;continue}let c=i;c!==""&&(c+=t.indentBy);let f=ji(h[":@"],t),u=i+`<${a}${f}`,d=Wi(h[a],t,l,c);t.unpairedTags.indexOf(a)!==-1?t.suppressUnpairedNode?n+=u+">":n+=u+"/>":(!d||d.length===0)&&t.suppressEmptyNode?n+=u+"/>":d&&d.endsWith(">")?n+=u+`>${d}${i}</${a}>`:(n+=u+">",d&&i!==""&&(d.includes("/>")||d.includes("</"))?n+=i+t.indentBy+d+i:n+=d,n+=`</${a}>`),r=!0;}return n}function Qo(s){let t=Object.keys(s);for(let e=0;e<t.length;e++){let i=t[e];if(s.hasOwnProperty(i)&&i!==":@")return i}}function ji(s,t){let e="";if(s&&!t.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=t.attributeValueProcessor(i,s[i]);n=Bi(n,t),n===!0&&t.suppressBooleanAttributes?e+=` ${i.substr(t.attributeNamePrefix.length)}`:e+=` ${i.substr(t.attributeNamePrefix.length)}="${n}"`;}return e}function ta(s,t){s=s.substr(0,s.length-t.textNodeName.length-1);let e=s.substr(s.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===s||t.stopNodes[i]==="*."+e)return !0;return !1}function Bi(s,t){if(s&&s.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){let i=t.entities[e];s=s.replace(i.regex,i.val);}return s}$i.exports=Jo;});var Gi=C((ll,Ui)=>{var ea=zi(),sa={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function st(s){this.options=Object.assign({},sa,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return !1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=ra),this.processTextOrObjNode=ia,this.options.format?(this.indentate=na,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return ""},this.tagEndChar=">",this.newLine="");}st.prototype.build=function(s){return this.options.preserveOrder?ea(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};st.prototype.j2x=function(s,t){let e="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",t);else if(typeof s[n]!="object"){let r=this.isAttribute(n);if(r)e+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o);}else i+=this.buildTextValNode(s[n],n,"",t);}else if(Array.isArray(s[n])){let r=s[n].length,o="";for(let h=0;h<r;h++){let a=s[n][h];typeof a>"u"||(a===null?n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar:typeof a=="object"?this.options.oneListGroup?o+=this.j2x(a,t+1).val:o+=this.processTextOrObjNode(a,n,t):o+=this.buildTextValNode(a,n,"",t));}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,"",t)),i+=o;}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){let r=Object.keys(s[n]),o=r.length;for(let h=0;h<o;h++)e+=this.buildAttrPairStr(r[h],""+s[n][r[h]]);}else i+=this.processTextOrObjNode(s[n],n,t);return {attrStr:e,val:i}};st.prototype.buildAttrPairStr=function(s,t){return t=this.options.attributeValueProcessor(s,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+s:" "+s+'="'+t+'"'};function ia(s,t,e){let i=this.j2x(s,e+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],t,i.attrStr,e):this.buildObjectNode(i.val,t,i.attrStr,e)}st.prototype.buildObjectNode=function(s,t,e,i){if(s==="")return t[0]==="?"?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",n=""),(e||e==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+t+e+r+">"+s+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+t+e+r+this.tagEndChar+s+this.indentate(i)+n}};st.prototype.closeTag=function(s){let t="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${s}`,t};st.prototype.buildTextValNode=function(s,t,e,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+n+"</"+t+this.tagEndChar}};st.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){let e=this.options.entities[t];s=s.replace(e.regex,e.val);}return s};function na(s){return this.options.indentBy.repeat(s)}function ra(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}Ui.exports=st;});var Hi=C((cl,Vi)=>{var oa=$e(),aa=Li(),ha=Gi();Vi.exports={XMLParser:aa,XMLValidator:oa,XMLBuilder:ha};});function sn(s){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var i=Array.from(typeof s=="string"?[s]:s);i[i.length-1]=i[i.length-1].replace(/\r?\n([\t ]*)$/,"");var n=i.reduce(function(h,a){var l=a.match(/\n([\t ]+|(?!\s).)/g);return l?h.concat(l.map(function(c){var f,u;return (u=(f=c.match(/[\t ]/g))===null||f===void 0?void 0:f.length)!==null&&u!==void 0?u:0})):h},[]);if(n.length){var r=new RegExp(`
[	 ]{`+Math.min.apply(Math,n)+"}","g");i=i.map(function(h){return h.replace(r,`
`)});}i[0]=i[0].replace(/^\r?\n/,"");var o=i[0];return t.forEach(function(h,a){var l=o.match(/(?:^|\n)( *)$/),c=l?l[1]:"",f=h;typeof h=="string"&&h.includes(`
`)&&(f=String(h).split(`
`).map(function(u,d){return d===0?u:""+c+u}).join(`
`)),o+=f+i[a+1];}),o}var N=sn;var rn={php:"php",script:"bin/console"},Ye=(s,t=[],e={})=>{let i={...rn,...e};return [i.php,i.script,s].concat([...t,"-v"]).map(n=>`'${n}'`).join(" ")},Ke=async s=>new Promise((t,e)=>{child_process.exec(s,(i,n,r)=>{i&&e(new Error(N`
                    Symfony console failed with exit status ${i.code}:
                    CMD: ${i.cmd}
                    Output: ${n}
                    Error output: ${r}
                `)),t(n);});}),Ut=async(s,t=[],e={})=>{let i=Ye(s,t,e);return Ke(i)},Gt=async(s,t=[],e={})=>{let i=Ye(s,[...t,"--format=json"],e),n=await Ke(i);try{return JSON.parse(n)}catch{throw new Error(N`
        Failed to process JSON output for Symfony command.
        CMD: ${i}
        Raw output: ${n}
        `)}},Ze=async()=>(await Gt("debug:container",["--parameter=kernel.project_dir"]))["kernel.project_dir"],Je=async()=>(await Gt("debug:config",["storybook"])).storybook,Qe=async()=>(await Gt("debug:config",["twig_component","--resolve-env"])).twig_component,ts=async()=>(await Gt("debug:config",["twig","--resolve-env"])).twig;var Vt=(s,t)=>{let e=new jsdom.JSDOM(s),i=e.window.document.head,n=e.window.document.body;return t.replace("<!--PREVIEW_HEAD_PLACEHOLDER-->",i.innerHTML).replace("<!--PREVIEW_BODY_PLACEHOLDER-->",n.innerHTML)};var de="preview-plugin",es=unplugin.createUnplugin(()=>({name:de,webpack(s){s.hooks.thisCompilation.tap(de,t=>{hn__default.default.getHooks(t).afterTemplateExecution.tapPromise(de,async e=>{try{let i=await Ut("storybook:generate-preview");return e.html=Vt(i,e.html),e}catch(i){return nodeLogger.logger.error(N`
                            Failed to inject Symfony preview template in main iframe.html.
                            ERR: ${i}
                            `),e}});});}}));var ui=zt(os());var ci=zt(fs());var Fs=zt(Ns(),1);var Et=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")};var _n={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},St=s=>s.replace(/[[\]\\-]/g,"\\$&"),kn=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),xs=s=>s.join(""),Cs=(s,t)=>{let e=t;if(s.charAt(e)!=="[")throw new Error("not in a brace expression");let i=[],n=[],r=e+1,o=!1,h=!1,a=!1,l=!1,c=e,f="";t:for(;r<s.length;){let p=s.charAt(r);if((p==="!"||p==="^")&&r===e+1){l=!0,r++;continue}if(p==="]"&&o&&!a){c=r+1;break}if(o=!0,p==="\\"&&!a){a=!0,r++;continue}if(p==="["&&!a){for(let[w,[m,b,E]]of Object.entries(_n))if(s.startsWith(w,r)){if(f)return ["$.",!1,s.length-e,!0];r+=w.length,E?n.push(m):i.push(m),h=h||b;continue t}}if(a=!1,f){p>f?i.push(St(f)+"-"+St(p)):p===f&&i.push(St(p)),f="",r++;continue}if(s.startsWith("-]",r+1)){i.push(St(p+"-")),r+=2;continue}if(s.startsWith("-",r+1)){f=p,r+=2;continue}i.push(St(p)),r++;}if(c<r)return ["",!1,0,!1];if(!i.length&&!n.length)return ["$.",!1,s.length-e,!0];if(n.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!l){let p=i[0].length===2?i[0].slice(-1):i[0];return [kn(p),!1,c-e,!1]}let u="["+(l?"^":"")+xs(i)+"]",d="["+(l?"":"^")+xs(n)+"]";return [i.length&&n.length?"("+u+"|"+d+")":i.length?u:d,h,c-e,!0]};var U=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var Pn=new Set(["!","?","+","*","@"]),As=s=>Pn.has(s),Fn="(?!(?:^|/)\\.\\.?(?:$|/))",Dt="(?!\\.)",Rn=new Set(["[","."]),In=new Set(["..","."]),Mn=new Set("().*{}+?[]^$\\!"),Ln=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Se="[^/]",Os=Se+"*?",_s=Se+"+?",at=class s{type;#t;#s;#r=!1;#i=[];#a;#l;#f;#h=!1;#o;#e;#g=!1;constructor(t,e,i={}){this.type=t,t&&(this.#s=!0),this.#a=e,this.#t=this.#a?this.#a.#t:this,this.#o=this.#t===this?i:this.#t.#o,this.#f=this.#t===this?[]:this.#t.#f,t==="!"&&!this.#t.#h&&this.#f.push(this),this.#l=this.#a?this.#a.#i.length:0;}get hasMagic(){if(this.#s!==void 0)return this.#s;for(let t of this.#i)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#s=!0;return this.#s}toString(){return this.#e!==void 0?this.#e:this.type?this.#e=this.type+"("+this.#i.map(t=>String(t)).join("|")+")":this.#e=this.#i.map(t=>String(t)).join("")}#w(){if(this!==this.#t)throw new Error("should only call on root");if(this.#h)return this;this.toString(),this.#h=!0;let t;for(;t=this.#f.pop();){if(t.type!=="!")continue;let e=t,i=e.#a;for(;i;){for(let n=e.#l+1;!i.type&&n<i.#i.length;n++)for(let r of t.#i){if(typeof r=="string")throw new Error("string part in extglob AST??");r.copyIn(i.#i[n]);}e=i,i=e.#a;}}return this}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof s&&e.#a===this))throw new Error("invalid part: "+e);this.#i.push(e);}}toJSON(){let t=this.type===null?this.#i.slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...this.#i.map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#h&&this.#a?.type==="!")&&t.push({}),t}isStart(){if(this.#t===this)return !0;if(!this.#a?.isStart())return !1;if(this.#l===0)return !0;let t=this.#a;for(let e=0;e<this.#l;e++){let i=t.#i[e];if(!(i instanceof s&&i.type==="!"))return !1}return !0}isEnd(){if(this.#t===this||this.#a?.type==="!")return !0;if(!this.#a?.isEnd())return !1;if(!this.type)return this.#a?.isEnd();let t=this.#a?this.#a.#i.length:0;return this.#l===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this));}clone(t){let e=new s(this.type,t);for(let i of this.#i)e.copyIn(i);return e}static#d(t,e,i,n){let r=!1,o=!1,h=-1,a=!1;if(e.type===null){let d=i,g="";for(;d<t.length;){let p=t.charAt(d++);if(r||p==="\\"){r=!r,g+=p;continue}if(o){d===h+1?(p==="^"||p==="!")&&(a=!0):p==="]"&&!(d===h+2&&a)&&(o=!1),g+=p;continue}else if(p==="["){o=!0,h=d,a=!1,g+=p;continue}if(!n.noext&&As(p)&&t.charAt(d)==="("){e.push(g),g="";let w=new s(p,e);d=s.#d(t,w,d,n),e.push(w);continue}g+=p;}return e.push(g),d}let l=i+1,c=new s(null,e),f=[],u="";for(;l<t.length;){let d=t.charAt(l++);if(r||d==="\\"){r=!r,u+=d;continue}if(o){l===h+1?(d==="^"||d==="!")&&(a=!0):d==="]"&&!(l===h+2&&a)&&(o=!1),u+=d;continue}else if(d==="["){o=!0,h=l,a=!1,u+=d;continue}if(As(d)&&t.charAt(l)==="("){c.push(u),u="";let g=new s(d,c);c.push(g),l=s.#d(t,g,l,n);continue}if(d==="|"){c.push(u),u="",f.push(c),c=new s(null,e);continue}if(d===")")return u===""&&e.#i.length===0&&(e.#g=!0),c.push(u),u="",e.push(...f,c),l;u+=d;}return e.type=null,e.#s=void 0,e.#i=[t.substring(i-1)],l}static fromGlob(t,e={}){let i=new s(null,void 0,e);return s.#d(t,i,0,e),i}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();let t=this.toString(),[e,i,n,r]=this.toRegExpSource();if(!(n||this.#s||this.#o.nocase&&!this.#o.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;let h=(this.#o.nocase?"i":"")+(r?"u":"");return Object.assign(new RegExp(`^${e}$`,h),{_src:e,_glob:t})}toRegExpSource(t){let e=t??!!this.#o.dot;if(this.#t===this&&this.#w(),!this.type){let a=this.isStart()&&this.isEnd(),l=this.#i.map(d=>{let[g,p,w,m]=typeof d=="string"?s.#E(d,this.#s,a):d.toRegExpSource(t);return this.#s=this.#s||w,this.#r=this.#r||m,g}).join(""),c="";if(this.isStart()&&typeof this.#i[0]=="string"&&!(this.#i.length===1&&In.has(this.#i[0]))){let g=Rn,p=e&&g.has(l.charAt(0))||l.startsWith("\\.")&&g.has(l.charAt(2))||l.startsWith("\\.\\.")&&g.has(l.charAt(4)),w=!e&&!t&&g.has(l.charAt(0));c=p?Fn:w?Dt:"";}let f="";return this.isEnd()&&this.#t.#h&&this.#a?.type==="!"&&(f="(?:$|\\/)"),[c+l+f,U(l),this.#s=!!this.#s,this.#r]}let i=this.type==="*"||this.type==="+",n=this.type==="!"?"(?:(?!(?:":"(?:",r=this.#u(e);if(this.isStart()&&this.isEnd()&&!r&&this.type!=="!"){let a=this.toString();return this.#i=[a],this.type=null,this.#s=void 0,[a,U(this.toString()),!1,!1]}let o=!i||t||e||!Dt?"":this.#u(!0);o===r&&(o=""),o&&(r=`(?:${r})(?:${o})*?`);let h="";if(this.type==="!"&&this.#g)h=(this.isStart()&&!e?Dt:"")+_s;else {let a=this.type==="!"?"))"+(this.isStart()&&!e&&!t?Dt:"")+Os+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;h=n+r+a;}return [h,U(r),this.#s=!!this.#s,this.#r]}#u(t){return this.#i.map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[i,n,r,o]=e.toRegExpSource(t);return this.#r=this.#r||o,i}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")}static#E(t,e,i=!1){let n=!1,r="",o=!1;for(let h=0;h<t.length;h++){let a=t.charAt(h);if(n){n=!1,r+=(Mn.has(a)?"\\":"")+a;continue}if(a==="\\"){h===t.length-1?r+="\\\\":n=!0;continue}if(a==="["){let[l,c,f,u]=Cs(t,h);if(f){r+=l,o=o||c,h+=f-1,e=e||u;continue}}if(a==="*"){i&&t==="*"?r+=_s:r+=Os,e=!0;continue}if(a==="?"){r+=Se,e=!0;continue}r+=Ln(a);}return [r,U(t),!!e,o]}};var ht=(s,{windowsPathsNoEscape:t=!1}={})=>t?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&");var R=(s,t,e={})=>(Et(t),!e.nocomment&&t.charAt(0)==="#"?!1:new L(t,e).match(s)),jn=/^\*+([^+@!?\*\[\(]*)$/,Wn=s=>t=>!t.startsWith(".")&&t.endsWith(s),Bn=s=>t=>t.endsWith(s),$n=s=>(s=s.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(s)),zn=s=>(s=s.toLowerCase(),t=>t.toLowerCase().endsWith(s)),Un=/^\*+\.\*+$/,Gn=s=>!s.startsWith(".")&&s.includes("."),Vn=s=>s!=="."&&s!==".."&&s.includes("."),Hn=/^\.\*+$/,Dn=s=>s!=="."&&s!==".."&&s.startsWith("."),qn=/^\*+$/,Xn=s=>s.length!==0&&!s.startsWith("."),Yn=s=>s.length!==0&&s!=="."&&s!=="..",Kn=/^\?+([^+@!?\*\[\(]*)?$/,Zn=([s,t=""])=>{let e=Rs([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},Jn=([s,t=""])=>{let e=Is([s]);return t?(t=t.toLowerCase(),i=>e(i)&&i.toLowerCase().endsWith(t)):e},Qn=([s,t=""])=>{let e=Is([s]);return t?i=>e(i)&&i.endsWith(t):e},tr=([s,t=""])=>{let e=Rs([s]);return t?i=>e(i)&&i.endsWith(t):e},Rs=([s])=>{let t=s.length;return e=>e.length===t&&!e.startsWith(".")},Is=([s])=>{let t=s.length;return e=>e.length===t&&e!=="."&&e!==".."},Ms=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",ks={win32:{sep:"\\"},posix:{sep:"/"}},er=Ms==="win32"?ks.win32.sep:ks.posix.sep;R.sep=er;var k=Symbol("globstar **");R.GLOBSTAR=k;var sr="[^/]",ir=sr+"*?",nr="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",rr="(?:(?!(?:\\/|^)\\.).)*?",or=(s,t={})=>e=>R(e,s,t);R.filter=or;var W=(s,t={})=>Object.assign({},s,t),ar=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return R;let t=R;return Object.assign((i,n,r={})=>t(i,n,W(s,r)),{Minimatch:class extends t.Minimatch{constructor(n,r={}){super(n,W(s,r));}static defaults(n){return t.defaults(W(s,n)).Minimatch}},AST:class extends t.AST{constructor(n,r,o={}){super(n,r,W(s,o));}static fromGlob(n,r={}){return t.AST.fromGlob(n,W(s,r))}},unescape:(i,n={})=>t.unescape(i,W(s,n)),escape:(i,n={})=>t.escape(i,W(s,n)),filter:(i,n={})=>t.filter(i,W(s,n)),defaults:i=>t.defaults(W(s,i)),makeRe:(i,n={})=>t.makeRe(i,W(s,n)),braceExpand:(i,n={})=>t.braceExpand(i,W(s,n)),match:(i,n,r={})=>t.match(i,n,W(s,r)),sep:t.sep,GLOBSTAR:k})};R.defaults=ar;var Ls=(s,t={})=>(Et(s),t.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:(0, Fs.default)(s));R.braceExpand=Ls;var hr=(s,t={})=>new L(s,t).makeRe();R.makeRe=hr;var lr=(s,t,e={})=>{let i=new L(t,e);return s=s.filter(n=>i.match(n)),i.options.nonull&&!s.length&&s.push(t),s};R.match=lr;var Ps=/[?*]|[+@!]\(.*?\)|\[|\]/,cr=s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),L=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){Et(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||Ms,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make();}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return !0;for(let t of this.set)for(let e of t)if(typeof e!="string")return !0;return !1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...r)=>console.error(...r)),this.debug(this.pattern,this.globSet);let i=this.globSet.map(r=>this.slashSplit(r));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let n=this.globParts.map((r,o,h)=>{if(this.isWindows&&this.windowsNoMagicRoot){let a=r[0]===""&&r[1]===""&&(r[2]==="?"||!Ps.test(r[2]))&&!Ps.test(r[3]),l=/^[a-z]:/i.test(r[0]);if(a)return [...r.slice(0,4),...r.slice(4).map(c=>this.parse(c))];if(l)return [r[0],...r.slice(1).map(c=>this.parse(c))]}return r.map(a=>this.parse(a))});if(this.debug(this.pattern,n),this.set=n.filter(r=>r.indexOf(!1)===-1),this.isWindows)for(let r=0;r<this.set.length;r++){let o=this.set[r];o[0]===""&&o[1]===""&&this.globParts[r][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?");}this.debug(this.pattern,this.set);}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let n=0;n<t[i].length;n++)t[i][n]==="**"&&(t[i][n]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let i=-1;for(;(i=e.indexOf("**",i+1))!==-1;){let n=i;for(;e[n+1]==="**";)n++;n!==i&&e.splice(i,n-i);}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((i,n)=>{let r=i[i.length-1];return n==="**"&&r==="**"?i:n===".."&&r&&r!==".."&&r!=="."&&r!=="**"?(i.pop(),i):(i.push(n),i)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let n=1;n<t.length-1;n++){let r=t[n];n===1&&r===""&&t[0]===""||(r==="."||r==="")&&(e=!0,t.splice(n,1),n--);}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop());}let i=0;for(;(i=t.indexOf("..",i+1))!==-1;){let n=t[i-1];n&&n!=="."&&n!==".."&&n!=="**"&&(e=!0,t.splice(i-1,2),i-=2);}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let i of t){let n=-1;for(;(n=i.indexOf("**",n+1))!==-1;){let o=n;for(;i[o+1]==="**";)o++;o>n&&i.splice(n+1,o-n);let h=i[n+1],a=i[n+2],l=i[n+3];if(h!==".."||!a||a==="."||a===".."||!l||l==="."||l==="..")continue;e=!0,i.splice(n,1);let c=i.slice(0);c[n]="**",t.push(c),n--;}if(!this.preserveMultipleSlashes){for(let o=1;o<i.length-1;o++){let h=i[o];o===1&&h===""&&i[0]===""||(h==="."||h==="")&&(e=!0,i.splice(o,1),o--);}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(e=!0,i.pop());}let r=0;for(;(r=i.indexOf("..",r+1))!==-1;){let o=i[r-1];if(o&&o!=="."&&o!==".."&&o!=="**"){e=!0;let a=r===1&&i[r+1]==="**"?["."]:[];i.splice(r-1,2,...a),i.length===0&&i.push(""),r-=2;}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let i=e+1;i<t.length;i++){let n=this.partsMatch(t[e],t[i],!this.preserveMultipleSlashes);n&&(t[e]=n,t[i]=[]);}return t.filter(e=>e.length)}partsMatch(t,e,i=!1){let n=0,r=0,o=[],h="";for(;n<t.length&&r<e.length;)if(t[n]===e[r])o.push(h==="b"?e[r]:t[n]),n++,r++;else if(i&&t[n]==="**"&&e[r]===t[n+1])o.push(t[n]),n++;else if(i&&e[r]==="**"&&t[n]===e[r+1])o.push(e[r]),r++;else if(t[n]==="*"&&e[r]&&(this.options.dot||!e[r].startsWith("."))&&e[r]!=="**"){if(h==="b")return !1;h="a",o.push(t[n]),n++,r++;}else if(e[r]==="*"&&t[n]&&(this.options.dot||!t[n].startsWith("."))&&t[n]!=="**"){if(h==="a")return !1;h="b",o.push(e[r]),n++,r++;}else return !1;return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,i=0;for(let n=0;n<t.length&&t.charAt(n)==="!";n++)e=!e,i++;i&&(this.pattern=t.slice(i)),this.negate=e;}matchOne(t,e,i=!1){let n=this.options;if(this.isWindows){let p=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),w=!p&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),m=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),b=!m&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),E=w?3:p?0:void 0,y=b?3:m?0:void 0;if(typeof E=="number"&&typeof y=="number"){let[S,v]=[t[E],e[y]];S.toLowerCase()===v.toLowerCase()&&(e[y]=S,y>E?e=e.slice(y):E>y&&(t=t.slice(E)));}}let{optimizationLevel:r=1}=this.options;r>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,h=0,a=t.length,l=e.length;o<a&&h<l;o++,h++){this.debug("matchOne loop");var c=e[h],f=t[o];if(this.debug(e,c,f),c===!1)return !1;if(c===k){this.debug("GLOBSTAR",[e,c,f]);var u=o,d=h+1;if(d===l){for(this.debug("** at the end");o<a;o++)if(t[o]==="."||t[o]===".."||!n.dot&&t[o].charAt(0)===".")return !1;return !0}for(;u<a;){var g=t[u];if(this.debug(`
globstar while`,t,u,e,d,g),this.matchOne(t.slice(u),e.slice(d),i))return this.debug("globstar found match!",u,a,g),!0;if(g==="."||g===".."||!n.dot&&g.charAt(0)==="."){this.debug("dot detected!",t,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++;}return !!(i&&(this.debug(`
>>> no match, partial?`,t,u,e,d),u===a))}let p;if(typeof c=="string"?(p=f===c,this.debug("string match",c,f,p)):(p=c.test(f),this.debug("pattern match",c,f,p)),!p)return !1}if(o===a&&h===l)return !0;if(o===a)return i;if(h===l)return o===a-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return Ls(this.pattern,this.options)}parse(t){Et(t);let e=this.options;if(t==="**")return k;if(t==="")return "";let i,n=null;(i=t.match(qn))?n=e.dot?Yn:Xn:(i=t.match(jn))?n=(e.nocase?e.dot?zn:$n:e.dot?Bn:Wn)(i[1]):(i=t.match(Kn))?n=(e.nocase?e.dot?Jn:Zn:e.dot?Qn:tr)(i):(i=t.match(Un))?n=e.dot?Vn:Gn:(i=t.match(Hn))&&(n=Dn);let r=at.fromGlob(t,this.options).toMMPattern();return n?Object.assign(r,{test:n}):r}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,i=e.noglobstar?ir:e.dot?nr:rr,n=new Set(e.nocase?["i"]:[]),r=t.map(a=>{let l=a.map(c=>{if(c instanceof RegExp)for(let f of c.flags.split(""))n.add(f);return typeof c=="string"?cr(c):c===k?k:c._src});return l.forEach((c,f)=>{let u=l[f+1],d=l[f-1];c!==k||d===k||(d===void 0?u!==void 0&&u!==k?l[f+1]="(?:\\/|"+i+"\\/)?"+u:l[f]=i:u===void 0?l[f-1]=d+"(?:\\/|"+i+")?":u!==k&&(l[f-1]=d+"(?:\\/|\\/"+i+"\\/)"+u,l[f+1]=k));}),l.filter(c=>c!==k).join("/")}).join("|"),[o,h]=t.length>1?["(?:",")"]:["",""];r="^"+o+r+h+"$",this.negate&&(r="^(?!"+r+").+$");try{this.regexp=new RegExp(r,[...n].join(""));}catch{this.regexp=!1;}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return !1;if(this.empty)return t==="";if(t==="/"&&e)return !0;let i=this.options;this.isWindows&&(t=t.split("\\").join("/"));let n=this.slashSplit(t);this.debug(this.pattern,"split",n);let r=this.set;this.debug(this.pattern,"set",r);let o=n[n.length-1];if(!o)for(let h=n.length-2;!o&&h>=0;h--)o=n[h];for(let h=0;h<r.length;h++){let a=r[h],l=n;if(i.matchBase&&a.length===1&&(l=[o]),this.matchOne(l,a,e))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(t){return R.defaults(t).Minimatch}};R.AST=at;R.Minimatch=L;R.escape=ht;R.unescape=U;var lt=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Ws=new Set,ve=typeof process=="object"&&process?process:{},Bs=(s,t,e,i)=>{typeof ve.emitWarning=="function"?ve.emitWarning(s,t,e,i):console.error(`[${e}] ${t}: ${s}`);},qt=globalThis.AbortController,js=globalThis.AbortSignal;if(typeof qt>"u"){js=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,n){this._onabort.push(n);}},qt=class{constructor(){t();}signal=new js;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(let n of this.signal._onabort)n(i);this.signal.onabort?.(i);}}};let s=ve.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{s&&(s=!1,Bs("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t));};}var fr=s=>!Ws.has(s),Q=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),$s=s=>Q(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?ct:null:null,ct=class extends Array{constructor(t){super(t),this.fill(0);}},Te=class s{heap;length;static#t=!1;static create(t){let e=$s(t);if(!e)return [];s.#t=!0;let i=new s(t,e);return s.#t=!1,i}constructor(t,e){if(!s.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0;}push(t){this.heap[this.length++]=t;}pop(){return this.heap[--this.length]}},vt=class s{#t;#s;#r;#i;#a;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#l;#f;#h;#o;#e;#g;#w;#d;#u;#E;#m;#x;#C;#S;#b;#O;#p;static unsafeExposeInternals(t){return {starts:t.#C,ttls:t.#S,sizes:t.#x,keyMap:t.#h,keyList:t.#o,valList:t.#e,next:t.#g,prev:t.#w,get head(){return t.#d},get tail(){return t.#u},free:t.#E,isBackgroundFetch:e=>t.#c(e),backgroundFetch:(e,i,n,r)=>t.#I(e,i,n,r),moveToTail:e=>t.#R(e),indexes:e=>t.#N(e),rindexes:e=>t.#_(e),isStale:e=>t.#y(e)}}get max(){return this.#t}get maxSize(){return this.#s}get calculatedSize(){return this.#f}get size(){return this.#l}get fetchMethod(){return this.#a}get dispose(){return this.#r}get disposeAfter(){return this.#i}constructor(t){let{max:e=0,ttl:i,ttlResolution:n=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:h,allowStale:a,dispose:l,disposeAfter:c,noDisposeOnSet:f,noUpdateTTL:u,maxSize:d=0,maxEntrySize:g=0,sizeCalculation:p,fetchMethod:w,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:b,allowStaleOnFetchRejection:E,allowStaleOnFetchAbort:y,ignoreFetchAbort:S}=t;if(e!==0&&!Q(e))throw new TypeError("max option must be a nonnegative integer");let v=e?$s(e):Array;if(!v)throw new Error("invalid max value: "+e);if(this.#t=e,this.#s=d,this.maxEntrySize=g||this.#s,this.sizeCalculation=p,this.sizeCalculation){if(!this.#s&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(w!==void 0&&typeof w!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#a=w,this.#O=!!w,this.#h=new Map,this.#o=new Array(e).fill(void 0),this.#e=new Array(e).fill(void 0),this.#g=new v(e),this.#w=new v(e),this.#d=0,this.#u=0,this.#E=Te.create(e),this.#l=0,this.#f=0,typeof l=="function"&&(this.#r=l),typeof c=="function"?(this.#i=c,this.#m=[]):(this.#i=void 0,this.#m=void 0),this.#b=!!this.#r,this.#p=!!this.#i,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!u,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!E,this.allowStaleOnFetchAbort=!!y,this.ignoreFetchAbort=!!S,this.maxEntrySize!==0){if(this.#s!==0&&!Q(this.#s))throw new TypeError("maxSize must be a positive integer if specified");if(!Q(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#P();}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!b,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!h,this.ttlResolution=Q(n)||n===0?n:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!Q(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#k();}if(this.#t===0&&this.ttl===0&&this.#s===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#s){let z="LRU_CACHE_UNBOUNDED";fr(z)&&(Ws.add(z),Bs("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",z,s));}}getRemainingTTL(t){return this.#h.has(t)?1/0:0}#k(){let t=new ct(this.#t),e=new ct(this.#t);this.#S=t,this.#C=e,this.#n=(r,o,h=lt.now())=>{if(e[r]=o!==0?h:0,t[r]=o,o!==0&&this.ttlAutopurge){let a=setTimeout(()=>{this.#y(r)&&this.delete(this.#o[r]);},o+1);a.unref&&a.unref();}},this.#A=r=>{e[r]=t[r]!==0?lt.now():0;},this.#v=(r,o)=>{if(t[o]){let h=t[o],a=e[o];if(!h||!a)return;r.ttl=h,r.start=a,r.now=i||n();let l=r.now-a;r.remainingTTL=h-l;}};let i=0,n=()=>{let r=lt.now();if(this.ttlResolution>0){i=r;let o=setTimeout(()=>i=0,this.ttlResolution);o.unref&&o.unref();}return r};this.getRemainingTTL=r=>{let o=this.#h.get(r);if(o===void 0)return 0;let h=t[o],a=e[o];if(!h||!a)return 1/0;let l=(i||n())-a;return h-l},this.#y=r=>{let o=e[r],h=t[r];return !!h&&!!o&&(i||n())-o>h};}#A=()=>{};#v=()=>{};#n=()=>{};#y=()=>!1;#P(){let t=new ct(this.#t);this.#f=0,this.#x=t,this.#T=e=>{this.#f-=t[e],t[e]=0;},this.#L=(e,i,n,r)=>{if(this.#c(i))return 0;if(!Q(n))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(n=r(i,e),!Q(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#M=(e,i,n)=>{if(t[e]=i,this.#s){let r=this.#s-t[e];for(;this.#f>r;)this.#F(!0);}this.#f+=t[e],n&&(n.entrySize=i,n.totalCalculatedSize=this.#f);};}#T=t=>{};#M=(t,e,i)=>{};#L=(t,e,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#N({allowStale:t=this.allowStale}={}){if(this.#l)for(let e=this.#u;!(!this.#j(e)||((t||!this.#y(e))&&(yield e),e===this.#d));)e=this.#w[e];}*#_({allowStale:t=this.allowStale}={}){if(this.#l)for(let e=this.#d;!(!this.#j(e)||((t||!this.#y(e))&&(yield e),e===this.#u));)e=this.#g[e];}#j(t){return t!==void 0&&this.#h.get(this.#o[t])===t}*entries(){for(let t of this.#N())this.#e[t]!==void 0&&this.#o[t]!==void 0&&!this.#c(this.#e[t])&&(yield [this.#o[t],this.#e[t]]);}*rentries(){for(let t of this.#_())this.#e[t]!==void 0&&this.#o[t]!==void 0&&!this.#c(this.#e[t])&&(yield [this.#o[t],this.#e[t]]);}*keys(){for(let t of this.#N()){let e=this.#o[t];e!==void 0&&!this.#c(this.#e[t])&&(yield e);}}*rkeys(){for(let t of this.#_()){let e=this.#o[t];e!==void 0&&!this.#c(this.#e[t])&&(yield e);}}*values(){for(let t of this.#N())this.#e[t]!==void 0&&!this.#c(this.#e[t])&&(yield this.#e[t]);}*rvalues(){for(let t of this.#_())this.#e[t]!==void 0&&!this.#c(this.#e[t])&&(yield this.#e[t]);}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(let i of this.#N()){let n=this.#e[i],r=this.#c(n)?n.__staleWhileFetching:n;if(r!==void 0&&t(r,this.#o[i],this))return this.get(this.#o[i],e)}}forEach(t,e=this){for(let i of this.#N()){let n=this.#e[i],r=this.#c(n)?n.__staleWhileFetching:n;r!==void 0&&t.call(e,r,this.#o[i],this);}}rforEach(t,e=this){for(let i of this.#_()){let n=this.#e[i],r=this.#c(n)?n.__staleWhileFetching:n;r!==void 0&&t.call(e,r,this.#o[i],this);}}purgeStale(){let t=!1;for(let e of this.#_({allowStale:!0}))this.#y(e)&&(this.delete(this.#o[e]),t=!0);return t}info(t){let e=this.#h.get(t);if(e===void 0)return;let i=this.#e[e],n=this.#c(i)?i.__staleWhileFetching:i;if(n===void 0)return;let r={value:n};if(this.#S&&this.#C){let o=this.#S[e],h=this.#C[e];if(o&&h){let a=o-(lt.now()-h);r.ttl=a,r.start=Date.now();}}return this.#x&&(r.size=this.#x[e]),r}dump(){let t=[];for(let e of this.#N({allowStale:!0})){let i=this.#o[e],n=this.#e[e],r=this.#c(n)?n.__staleWhileFetching:n;if(r===void 0||i===void 0)continue;let o={value:r};if(this.#S&&this.#C){o.ttl=this.#S[e];let h=lt.now()-this.#C[e];o.start=Math.floor(Date.now()-h);}this.#x&&(o.size=this.#x[e]),t.unshift([i,o]);}return t}load(t){this.clear();for(let[e,i]of t){if(i.start){let n=Date.now()-i.start;i.start=lt.now()-n;}this.set(e,i.value,i);}}set(t,e,i={}){if(e===void 0)return this.delete(t),this;let{ttl:n=this.ttl,start:r,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:h=this.sizeCalculation,status:a}=i,{noUpdateTTL:l=this.noUpdateTTL}=i,c=this.#L(t,e,i.size||0,h);if(this.maxEntrySize&&c>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.delete(t),this;let f=this.#l===0?void 0:this.#h.get(t);if(f===void 0)f=this.#l===0?this.#u:this.#E.length!==0?this.#E.pop():this.#l===this.#t?this.#F(!1):this.#l,this.#o[f]=t,this.#e[f]=e,this.#h.set(t,f),this.#g[this.#u]=f,this.#w[f]=this.#u,this.#u=f,this.#l++,this.#M(f,c,a),a&&(a.set="add"),l=!1;else {this.#R(f);let u=this.#e[f];if(e!==u){if(this.#O&&this.#c(u)){u.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:d}=u;d!==void 0&&!o&&(this.#b&&this.#r?.(d,t,"set"),this.#p&&this.#m?.push([d,t,"set"]));}else o||(this.#b&&this.#r?.(u,t,"set"),this.#p&&this.#m?.push([u,t,"set"]));if(this.#T(f),this.#M(f,c,a),this.#e[f]=e,a){a.set="replace";let d=u&&this.#c(u)?u.__staleWhileFetching:u;d!==void 0&&(a.oldValue=d);}}else a&&(a.set="update");}if(n!==0&&!this.#S&&this.#k(),this.#S&&(l||this.#n(f,n,r),a&&this.#v(a,f)),!o&&this.#p&&this.#m){let u=this.#m,d;for(;d=u?.shift();)this.#i?.(...d);}return this}pop(){try{for(;this.#l;){let t=this.#e[this.#d];if(this.#F(!0),this.#c(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#p&&this.#m){let t=this.#m,e;for(;e=t?.shift();)this.#i?.(...e);}}}#F(t){let e=this.#d,i=this.#o[e],n=this.#e[e];return this.#O&&this.#c(n)?n.__abortController.abort(new Error("evicted")):(this.#b||this.#p)&&(this.#b&&this.#r?.(n,i,"evict"),this.#p&&this.#m?.push([n,i,"evict"])),this.#T(e),t&&(this.#o[e]=void 0,this.#e[e]=void 0,this.#E.push(e)),this.#l===1?(this.#d=this.#u=0,this.#E.length=0):this.#d=this.#g[e],this.#h.delete(i),this.#l--,e}has(t,e={}){let{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=e,r=this.#h.get(t);if(r!==void 0){let o=this.#e[r];if(this.#c(o)&&o.__staleWhileFetching===void 0)return !1;if(this.#y(r))n&&(n.has="stale",this.#v(n,r));else return i&&this.#A(r),n&&(n.has="hit",this.#v(n,r)),!0}else n&&(n.has="miss");return !1}peek(t,e={}){let{allowStale:i=this.allowStale}=e,n=this.#h.get(t);if(n===void 0||!i&&this.#y(n))return;let r=this.#e[n];return this.#c(r)?r.__staleWhileFetching:r}#I(t,e,i,n){let r=e===void 0?void 0:this.#e[e];if(this.#c(r))return r;let o=new qt,{signal:h}=i;h?.addEventListener("abort",()=>o.abort(h.reason),{signal:o.signal});let a={signal:o.signal,options:i,context:n},l=(p,w=!1)=>{let{aborted:m}=o.signal,b=i.ignoreFetchAbort&&p!==void 0;if(i.status&&(m&&!w?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,b&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),m&&!b&&!w)return f(o.signal.reason);let E=d;return this.#e[e]===d&&(p===void 0?E.__staleWhileFetching?this.#e[e]=E.__staleWhileFetching:this.delete(t):(i.status&&(i.status.fetchUpdated=!0),this.set(t,p,a.options))),p},c=p=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=p),f(p)),f=p=>{let{aborted:w}=o.signal,m=w&&i.allowStaleOnFetchAbort,b=m||i.allowStaleOnFetchRejection,E=b||i.noDeleteOnFetchRejection,y=d;if(this.#e[e]===d&&(!E||y.__staleWhileFetching===void 0?this.delete(t):m||(this.#e[e]=y.__staleWhileFetching)),b)return i.status&&y.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),y.__staleWhileFetching;if(y.__returned===y)throw p},u=(p,w)=>{let m=this.#a?.(t,r,a);m&&m instanceof Promise&&m.then(b=>p(b===void 0?void 0:b),w),o.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(p(void 0),i.allowStaleOnFetchAbort&&(p=b=>l(b,!0)));});};i.status&&(i.status.fetchDispatched=!0);let d=new Promise(u).then(l,c),g=Object.assign(d,{__abortController:o,__staleWhileFetching:r,__returned:void 0});return e===void 0?(this.set(t,g,{...a.options,status:void 0}),e=this.#h.get(t)):this.#e[e]=g,g}#c(t){if(!this.#O)return !1;let e=t;return !!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof qt}async fetch(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:h=this.noDisposeOnSet,size:a=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:p,forceRefresh:w=!1,status:m,signal:b}=e;if(!this.#O)return m&&(m.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,status:m});let E={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:h,size:a,sizeCalculation:l,noUpdateTTL:c,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:g,ignoreFetchAbort:d,status:m,signal:b},y=this.#h.get(t);if(y===void 0){m&&(m.fetch="miss");let S=this.#I(t,y,E,p);return S.__returned=S}else {let S=this.#e[y];if(this.#c(S)){let $t=i&&S.__staleWhileFetching!==void 0;return m&&(m.fetch="inflight",$t&&(m.returnedStale=!0)),$t?S.__staleWhileFetching:S.__returned=S}let v=this.#y(y);if(!w&&!v)return m&&(m.fetch="hit"),this.#R(y),n&&this.#A(y),m&&this.#v(m,y),S;let z=this.#I(t,y,E,p),D=z.__staleWhileFetching!==void 0&&i;return m&&(m.fetch=v?"stale":"refresh",D&&v&&(m.returnedStale=!0)),D?z.__staleWhileFetching:z.__returned=z}}get(t,e={}){let{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=e,h=this.#h.get(t);if(h!==void 0){let a=this.#e[h],l=this.#c(a);return o&&this.#v(o,h),this.#y(h)?(o&&(o.get="stale"),l?(o&&i&&a.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?a.__staleWhileFetching:void 0):(r||this.delete(t),o&&i&&(o.returnedStale=!0),i?a:void 0)):(o&&(o.get="hit"),l?a.__staleWhileFetching:(this.#R(h),n&&this.#A(h),a))}else o&&(o.get="miss");}#W(t,e){this.#w[e]=t,this.#g[t]=e;}#R(t){t!==this.#u&&(t===this.#d?this.#d=this.#g[t]:this.#W(this.#w[t],this.#g[t]),this.#W(this.#u,t),this.#u=t);}delete(t){let e=!1;if(this.#l!==0){let i=this.#h.get(t);if(i!==void 0)if(e=!0,this.#l===1)this.clear();else {this.#T(i);let n=this.#e[i];if(this.#c(n)?n.__abortController.abort(new Error("deleted")):(this.#b||this.#p)&&(this.#b&&this.#r?.(n,t,"delete"),this.#p&&this.#m?.push([n,t,"delete"])),this.#h.delete(t),this.#o[i]=void 0,this.#e[i]=void 0,i===this.#u)this.#u=this.#w[i];else if(i===this.#d)this.#d=this.#g[i];else {let r=this.#w[i];this.#g[r]=this.#g[i];let o=this.#g[i];this.#w[o]=this.#w[i];}this.#l--,this.#E.push(i);}}if(this.#p&&this.#m?.length){let i=this.#m,n;for(;n=i?.shift();)this.#i?.(...n);}return e}clear(){for(let t of this.#_({allowStale:!0})){let e=this.#e[t];if(this.#c(e))e.__abortController.abort(new Error("deleted"));else {let i=this.#o[t];this.#b&&this.#r?.(e,i,"delete"),this.#p&&this.#m?.push([e,i,"delete"]);}}if(this.#h.clear(),this.#e.fill(void 0),this.#o.fill(void 0),this.#S&&this.#C&&(this.#S.fill(0),this.#C.fill(0)),this.#x&&this.#x.fill(0),this.#d=0,this.#u=0,this.#E.length=0,this.#f=0,this.#l=0,this.#p&&this.#m){let t=this.#m,e;for(;e=t?.shift();)this.#i?.(...e);}}};var zs=typeof process=="object"&&process?process:{stdout:null,stderr:null},dr=s=>!!s&&typeof s=="object"&&(s instanceof et||s instanceof Hs__default.default||pr(s)||gr(s)),pr=s=>!!s&&typeof s=="object"&&s instanceof events.EventEmitter&&typeof s.pipe=="function"&&s.pipe!==Hs__default.default.Writable.prototype.pipe,gr=s=>!!s&&typeof s=="object"&&s instanceof events.EventEmitter&&typeof s.write=="function"&&typeof s.end=="function",Y=Symbol("EOF"),K=Symbol("maybeEmitEnd"),tt=Symbol("emittedEnd"),Xt=Symbol("emittingEnd"),Tt=Symbol("emittedError"),Yt=Symbol("closed"),Us=Symbol("read"),Kt=Symbol("flush"),Gs=Symbol("flushChunk"),G=Symbol("encoding"),ft=Symbol("decoder"),A=Symbol("flowing"),Nt=Symbol("paused"),ut=Symbol("resume"),O=Symbol("buffer"),I=Symbol("pipes"),_=Symbol("bufferLength"),Ne=Symbol("bufferPush"),Zt=Symbol("bufferShift"),P=Symbol("objectMode"),T=Symbol("destroyed"),xe=Symbol("error"),Ce=Symbol("emitData"),Vs=Symbol("emitEnd"),Ae=Symbol("emitEnd2"),q=Symbol("async"),Oe=Symbol("abort"),Jt=Symbol("aborted"),xt=Symbol("signal"),it=Symbol("dataListeners"),j=Symbol("discarded"),Ct=s=>Promise.resolve().then(s),mr=s=>s(),wr=s=>s==="end"||s==="finish"||s==="prefinish",yr=s=>s instanceof ArrayBuffer||!!s&&typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,br=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),Qt=class{src;dest;opts;ondrain;constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[ut](),this.dest.on("drain",this.ondrain);}unpipe(){this.dest.removeListener("drain",this.ondrain);}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end();}},_e=class extends Qt{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe();}constructor(t,e,i){super(t,e,i),this.proxyErrors=n=>e.emit("error",n),t.on("error",this.proxyErrors);}},Er=s=>!!s.objectMode,Sr=s=>!s.objectMode&&!!s.encoding&&s.encoding!=="buffer",et=class extends events.EventEmitter{[A]=!1;[Nt]=!1;[I]=[];[O]=[];[P];[G];[q];[ft];[Y]=!1;[tt]=!1;[Xt]=!1;[Yt]=!1;[Tt]=null;[_]=0;[T]=!1;[xt];[Jt]=!1;[it]=0;[j]=!1;writable=!0;readable=!0;constructor(...t){let e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Er(e)?(this[P]=!0,this[G]=null):Sr(e)?(this[G]=e.encoding,this[P]=!1):(this[P]=!1,this[G]=null),this[q]=!!e.async,this[ft]=this[G]?new string_decoder.StringDecoder(this[G]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[O]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[I]});let{signal:i}=e;i&&(this[xt]=i,i.aborted?this[Oe]():i.addEventListener("abort",()=>this[Oe]()));}get bufferLength(){return this[_]}get encoding(){return this[G]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[P]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[q]}set async(t){this[q]=this[q]||!!t;}[Oe](){this[Jt]=!0,this.emit("abort",this[xt]?.reason),this.destroy(this[xt]?.reason);}get aborted(){return this[Jt]}set aborted(t){}write(t,e,i){if(this[Jt])return !1;if(this[Y])throw new Error("write after end");if(this[T])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");let n=this[q]?Ct:mr;if(!this[P]&&!Buffer.isBuffer(t)){if(br(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(yr(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[P]?(this[A]&&this[_]!==0&&this[Kt](!0),this[A]?this.emit("data",t):this[Ne](t),this[_]!==0&&this.emit("readable"),i&&n(i),this[A]):t.length?(typeof t=="string"&&!(e===this[G]&&!this[ft]?.lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[G]&&(t=this[ft].write(t)),this[A]&&this[_]!==0&&this[Kt](!0),this[A]?this.emit("data",t):this[Ne](t),this[_]!==0&&this.emit("readable"),i&&n(i),this[A]):(this[_]!==0&&this.emit("readable"),i&&n(i),this[A])}read(t){if(this[T])return null;if(this[j]=!1,this[_]===0||t===0||t&&t>this[_])return this[K](),null;this[P]&&(t=null),this[O].length>1&&!this[P]&&(this[O]=[this[G]?this[O].join(""):Buffer.concat(this[O],this[_])]);let e=this[Us](t||null,this[O][0]);return this[K](),e}[Us](t,e){if(this[P])this[Zt]();else {let i=e;t===i.length||t===null?this[Zt]():typeof i=="string"?(this[O][0]=i.slice(t),e=i.slice(0,t),this[_]-=t):(this[O][0]=i.subarray(t),e=i.subarray(0,t),this[_]-=t);}return this.emit("data",e),!this[O].length&&!this[Y]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e="utf8"),t!==void 0&&this.write(t,e),i&&this.once("end",i),this[Y]=!0,this.writable=!1,(this[A]||!this[Nt])&&this[K](),this}[ut](){this[T]||(!this[it]&&!this[I].length&&(this[j]=!0),this[Nt]=!1,this[A]=!0,this.emit("resume"),this[O].length?this[Kt]():this[Y]?this[K]():this.emit("drain"));}resume(){return this[ut]()}pause(){this[A]=!1,this[Nt]=!0,this[j]=!1;}get destroyed(){return this[T]}get flowing(){return this[A]}get paused(){return this[Nt]}[Ne](t){this[P]?this[_]+=1:this[_]+=t.length,this[O].push(t);}[Zt](){return this[P]?this[_]-=1:this[_]-=this[O][0].length,this[O].shift()}[Kt](t=!1){do;while(this[Gs](this[Zt]())&&this[O].length);!t&&!this[O].length&&!this[Y]&&this.emit("drain");}[Gs](t){return this.emit("data",t),this[A]}pipe(t,e){if(this[T])return t;this[j]=!1;let i=this[tt];return e=e||{},t===zs.stdout||t===zs.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[I].push(e.proxyErrors?new _e(this,t,e):new Qt(this,t,e)),this[q]?Ct(()=>this[ut]()):this[ut]()),t}unpipe(t){let e=this[I].find(i=>i.dest===t);e&&(this[I].length===1?(this[A]&&this[it]===0&&(this[A]=!1),this[I]=[]):this[I].splice(this[I].indexOf(e),1),e.unpipe());}addListener(t,e){return this.on(t,e)}on(t,e){let i=super.on(t,e);if(t==="data")this[j]=!1,this[it]++,!this[I].length&&!this[A]&&this[ut]();else if(t==="readable"&&this[_]!==0)super.emit("readable");else if(wr(t)&&this[tt])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[Tt]){let n=e;this[q]?Ct(()=>n.call(this,this[Tt])):n.call(this,this[Tt]);}return i}removeListener(t,e){return this.off(t,e)}off(t,e){let i=super.off(t,e);return t==="data"&&(this[it]=this.listeners("data").length,this[it]===0&&!this[j]&&!this[I].length&&(this[A]=!1)),i}removeAllListeners(t){let e=super.removeAllListeners(t);return (t==="data"||t===void 0)&&(this[it]=0,!this[j]&&!this[I].length&&(this[A]=!1)),e}get emittedEnd(){return this[tt]}[K](){!this[Xt]&&!this[tt]&&!this[T]&&this[O].length===0&&this[Y]&&(this[Xt]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Yt]&&this.emit("close"),this[Xt]=!1);}emit(t,...e){let i=e[0];if(t!=="error"&&t!=="close"&&t!==T&&this[T])return !1;if(t==="data")return !this[P]&&!i?!1:this[q]?(Ct(()=>this[Ce](i)),!0):this[Ce](i);if(t==="end")return this[Vs]();if(t==="close"){if(this[Yt]=!0,!this[tt]&&!this[T])return !1;let r=super.emit("close");return this.removeAllListeners("close"),r}else if(t==="error"){this[Tt]=i,super.emit(xe,i);let r=!this[xt]||this.listeners("error").length?super.emit("error",i):!1;return this[K](),r}else if(t==="resume"){let r=super.emit("resume");return this[K](),r}else if(t==="finish"||t==="prefinish"){let r=super.emit(t);return this.removeAllListeners(t),r}let n=super.emit(t,...e);return this[K](),n}[Ce](t){for(let i of this[I])i.dest.write(t)===!1&&this.pause();let e=this[j]?!1:super.emit("data",t);return this[K](),e}[Vs](){return this[tt]?!1:(this[tt]=!0,this.readable=!1,this[q]?(Ct(()=>this[Ae]()),!0):this[Ae]())}[Ae](){if(this[ft]){let e=this[ft].end();if(e){for(let i of this[I])i.dest.write(e);this[j]||super.emit("data",e);}}for(let e of this[I])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){let t=Object.assign([],{dataLength:0});this[P]||(t.dataLength=0);let e=this.promise();return this.on("data",i=>{t.push(i),this[P]||(t.dataLength+=i.length);}),await e,t}async concat(){if(this[P])throw new Error("cannot concat in objectMode");let t=await this.collect();return this[G]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(T,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t());})}[Symbol.asyncIterator](){this[j]=!1;let t=!1,e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return {next:()=>{if(t)return e();let n=this.read();if(n!==null)return Promise.resolve({done:!1,value:n});if(this[Y])return e();let r,o,h=f=>{this.off("data",a),this.off("end",l),this.off(T,c),e(),o(f);},a=f=>{this.off("error",h),this.off("end",l),this.off(T,c),this.pause(),r({value:f,done:!!this[Y]});},l=()=>{this.off("error",h),this.off("data",a),this.off(T,c),e(),r({done:!0,value:void 0});},c=()=>h(new Error("stream destroyed"));return new Promise((f,u)=>{o=u,r=f,this.once(T,c),this.once("error",h),this.once("end",l),this.once("data",a);})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[j]=!1;let t=!1,e=()=>(this.pause(),this.off(xe,e),this.off(T,e),this.off("end",e),t=!0,{done:!0,value:void 0}),i=()=>{if(t)return e();let n=this.read();return n===null?e():{done:!1,value:n}};return this.once("end",e),this.once(xe,e),this.once(T,e),{next:i,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[T])return t?this.emit("error",t):this.emit(T),this;this[T]=!0,this[j]=!0,this[O].length=0,this[_]=0;let e=this;return typeof e.close=="function"&&!this[Yt]&&e.close(),t?this.emit("error",t):this.emit(T),this}static get isStream(){return dr}};var kr=li.realpathSync.native,Ot={lstatSync:li.lstatSync,readdir:li.readdir,readdirSync:li.readdirSync,readlinkSync:li.readlinkSync,realpathSync:kr,promises:{lstat:promises.lstat,readdir:promises.readdir,readlink:promises.readlink,realpath:promises.realpath}},Ks=s=>!s||s===Ot||s===li__namespace?Ot:{...Ot,...s,promises:{...Ot.promises,...s.promises||{}}},Zs=/^\\\\\?\\([a-z]:)\\?$/i,Mr=s=>s.replace(/\//g,"\\").replace(Zs,"$1\\"),Lr=/[\\\/]/,$=0,Js=1,Qs=2,X=4,ti=6,ei=8,nt=10,si=12,B=15,At=~B,Pe=16,Ds=32,_t=64,V=128,te=256,se=512,qs=_t|V|se,jr=1023,Fe=s=>s.isFile()?ei:s.isDirectory()?X:s.isSymbolicLink()?nt:s.isCharacterDevice()?Qs:s.isBlockDevice()?ti:s.isSocket()?si:s.isFIFO()?Js:$,Xs=new Map,kt=s=>{let t=Xs.get(s);if(t)return t;let e=s.normalize("NFKD");return Xs.set(s,e),e},Ys=new Map,ee=s=>{let t=Ys.get(s);if(t)return t;let e=kt(s.toLowerCase());return Ys.set(s,e),e},ie=class extends vt{constructor(){super({max:256});}},Ie=class extends vt{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1});}},ii=Symbol("PathScurry setAsCwd"),F=class{name;root;roots;parent;nocase;#t;#s;get dev(){return this.#s}#r;get mode(){return this.#r}#i;get nlink(){return this.#i}#a;get uid(){return this.#a}#l;get gid(){return this.#l}#f;get rdev(){return this.#f}#h;get blksize(){return this.#h}#o;get ino(){return this.#o}#e;get size(){return this.#e}#g;get blocks(){return this.#g}#w;get atimeMs(){return this.#w}#d;get mtimeMs(){return this.#d}#u;get ctimeMs(){return this.#u}#E;get birthtimeMs(){return this.#E}#m;get atime(){return this.#m}#x;get mtime(){return this.#x}#C;get ctime(){return this.#C}#S;get birthtime(){return this.#S}#b;#O;#p;#k;#A;#v;#n;#y;#P;#T;get path(){return (this.parent||this).fullpath()}constructor(t,e=$,i,n,r,o,h){this.name=t,this.#b=r?ee(t):kt(t),this.#n=e&jr,this.nocase=r,this.roots=n,this.root=i||this,this.#y=o,this.#p=h.fullpath,this.#A=h.relative,this.#v=h.relativePosix,this.parent=h.parent,this.parent?this.#t=this.parent.#t:this.#t=Ks(h.fs);}depth(){return this.#O!==void 0?this.#O:this.parent?this.#O=this.parent.depth()+1:this.#O=0}childrenCache(){return this.#y}resolve(t){if(!t)return this;let e=this.getRootString(t),n=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#M(n):this.#M(n)}#M(t){let e=this;for(let i of t)e=e.child(i);return e}children(){let t=this.#y.get(this);if(t)return t;let e=Object.assign([],{provisional:0});return this.#y.set(this,e),this.#n&=~Pe,e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;let i=this.children(),n=this.nocase?ee(t):kt(t);for(let a of i)if(a.#b===n)return a;let r=this.parent?this.sep:"",o=this.#p?this.#p+r+t:void 0,h=this.newChild(t,$,{...e,parent:this,fullpath:o});return this.canReaddir()||(h.#n|=V),i.push(h),h}relative(){if(this.#A!==void 0)return this.#A;let t=this.name,e=this.parent;if(!e)return this.#A=this.name;let i=e.relative();return i+(!i||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(this.#v!==void 0)return this.#v;let t=this.name,e=this.parent;if(!e)return this.#v=this.fullpathPosix();let i=e.relativePosix();return i+(!i||!e.parent?"":"/")+t}fullpath(){if(this.#p!==void 0)return this.#p;let t=this.name,e=this.parent;if(!e)return this.#p=this.name;let n=e.fullpath()+(e.parent?this.sep:"")+t;return this.#p=n}fullpathPosix(){if(this.#k!==void 0)return this.#k;if(this.sep==="/")return this.#k=this.fullpath();if(!this.parent){let n=this.fullpath().replace(/\\/g,"/");return /^[a-z]:\//i.test(n)?this.#k=`//?/${n}`:this.#k=n}let t=this.parent,e=t.fullpathPosix(),i=e+(!e||!t.parent?"":"/")+this.name;return this.#k=i}isUnknown(){return (this.#n&B)===$}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return (this.#n&B)===ei}isDirectory(){return (this.#n&B)===X}isCharacterDevice(){return (this.#n&B)===Qs}isBlockDevice(){return (this.#n&B)===ti}isFIFO(){return (this.#n&B)===Js}isSocket(){return (this.#n&B)===si}isSymbolicLink(){return (this.#n&nt)===nt}lstatCached(){return this.#n&Ds?this:void 0}readlinkCached(){return this.#P}realpathCached(){return this.#T}readdirCached(){let t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#P)return !0;if(!this.parent)return !1;let t=this.#n&B;return !(t!==$&&t!==nt||this.#n&te||this.#n&V)}calledReaddir(){return !!(this.#n&Pe)}isENOENT(){return !!(this.#n&V)}isNamed(t){return this.nocase?this.#b===ee(t):this.#b===kt(t)}async readlink(){let t=this.#P;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=await this.#t.promises.readlink(this.fullpath()),i=this.parent.resolve(e);if(i)return this.#P=i}catch(e){this.#W(e.code);return}}readlinkSync(){let t=this.#P;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=this.#t.readlinkSync(this.fullpath()),i=this.parent.resolve(e);if(i)return this.#P=i}catch(e){this.#W(e.code);return}}#L(t){this.#n|=Pe;for(let e=t.provisional;e<t.length;e++)t[e].#N();}#N(){this.#n&V||(this.#n=(this.#n|V)&At,this.#_());}#_(){let t=this.children();t.provisional=0;for(let e of t)e.#N();}#j(){this.#n|=se,this.#F();}#F(){if(this.#n&_t)return;let t=this.#n;(t&B)===X&&(t&=At),this.#n=t|_t,this.#_();}#I(t=""){t==="ENOTDIR"||t==="EPERM"?this.#F():t==="ENOENT"?this.#N():this.children().provisional=0;}#c(t=""){t==="ENOTDIR"?this.parent.#F():t==="ENOENT"&&this.#N();}#W(t=""){let e=this.#n;e|=te,t==="ENOENT"&&(e|=V),(t==="EINVAL"||t==="UNKNOWN")&&(e&=At),this.#n=e,t==="ENOTDIR"&&this.parent&&this.parent.#F();}#R(t,e){return this.#V(t,e)||this.#G(t,e)}#G(t,e){let i=Fe(t),n=this.newChild(t.name,i,{parent:this}),r=n.#n&B;return r!==X&&r!==nt&&r!==$&&(n.#n|=_t),e.unshift(n),e.provisional++,n}#V(t,e){for(let i=e.provisional;i<e.length;i++){let n=e[i];if((this.nocase?ee(t.name):kt(t.name))===n.#b)return this.#H(t,n,i,e)}}#H(t,e,i,n){let r=e.name;return e.#n=e.#n&At|Fe(t),r!==t.name&&(e.name=t.name),i!==n.provisional&&(i===n.length-1?n.pop():n.splice(i,1),n.unshift(e)),n.provisional++,e}async lstat(){if(!(this.#n&V))try{return this.#U(await this.#t.promises.lstat(this.fullpath())),this}catch(t){this.#c(t.code);}}lstatSync(){if(!(this.#n&V))try{return this.#U(this.#t.lstatSync(this.fullpath())),this}catch(t){this.#c(t.code);}}#U(t){let{atime:e,atimeMs:i,birthtime:n,birthtimeMs:r,blksize:o,blocks:h,ctime:a,ctimeMs:l,dev:c,gid:f,ino:u,mode:d,mtime:g,mtimeMs:p,nlink:w,rdev:m,size:b,uid:E}=t;this.#m=e,this.#w=i,this.#S=n,this.#E=r,this.#h=o,this.#g=h,this.#C=a,this.#u=l,this.#s=c,this.#l=f,this.#o=u,this.#r=d,this.#x=g,this.#d=p,this.#i=w,this.#f=m,this.#e=b,this.#a=E;let y=Fe(t);this.#n=this.#n&At|y|Ds,y!==$&&y!==X&&y!==nt&&(this.#n|=_t);}#$=[];#z=!1;#D(t){this.#z=!1;let e=this.#$.slice();this.#$.length=0,e.forEach(i=>i(null,t));}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}let i=this.children();if(this.calledReaddir()){let r=i.slice(0,i.provisional);e?t(null,r):queueMicrotask(()=>t(null,r));return}if(this.#$.push(t),this.#z)return;this.#z=!0;let n=this.fullpath();this.#t.readdir(n,{withFileTypes:!0},(r,o)=>{if(r)this.#I(r.code),i.provisional=0;else {for(let h of o)this.#R(h,i);this.#L(i);}this.#D(i.slice(0,i.provisional));});}#B;async readdir(){if(!this.canReaddir())return [];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();if(this.#B)await this.#B;else {let i=()=>{};this.#B=new Promise(n=>i=n);try{for(let n of await this.#t.promises.readdir(e,{withFileTypes:!0}))this.#R(n,t);this.#L(t);}catch(n){this.#I(n.code),t.provisional=0;}this.#B=void 0,i();}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return [];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();try{for(let i of this.#t.readdirSync(e,{withFileTypes:!0}))this.#R(i,t);this.#L(t);}catch(i){this.#I(i.code),t.provisional=0;}return t.slice(0,t.provisional)}canReaddir(){if(this.#n&qs)return !1;let t=B&this.#n;return t===$||t===X||t===nt}shouldWalk(t,e){return (this.#n&X)===X&&!(this.#n&qs)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#T)return this.#T;if(!((se|te|V)&this.#n))try{let t=await this.#t.promises.realpath(this.fullpath());return this.#T=this.resolve(t)}catch{this.#j();}}realpathSync(){if(this.#T)return this.#T;if(!((se|te|V)&this.#n))try{let t=this.#t.realpathSync(this.fullpath());return this.#T=this.resolve(t)}catch{this.#j();}}[ii](t){if(t===this)return;let e=new Set([]),i=[],n=this;for(;n&&n.parent;)e.add(n),n.#A=i.join(this.sep),n.#v=i.join("/"),n=n.parent,i.push("..");for(n=t;n&&n.parent&&!e.has(n);)n.#A=void 0,n.#v=void 0,n=n.parent;}},ne=class s extends F{sep="\\";splitSep=Lr;constructor(t,e=$,i,n,r,o,h){super(t,e,i,n,r,o,h);}newChild(t,e=$,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}getRootString(t){return qe.win32.parse(t).root}getRoot(t){if(t=Mr(t.toUpperCase()),t===this.root.name)return this.root;for(let[e,i]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=i;return this.roots[t]=new dt(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(Zs,"$1\\"),t===e}},re=class s extends F{splitSep="/";sep="/";constructor(t,e=$,i,n,r,o,h){super(t,e,i,n,r,o,h);}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=$,i={}){return new s(t,e,this.root,this.roots,this.nocase,this.childrenCache(),i)}},oe=class{root;rootPath;roots;cwd;#t;#s;#r;nocase;#i;constructor(t=process.cwd(),e,i,{nocase:n,childrenCacheSize:r=16*1024,fs:o=Ot}={}){this.#i=Ks(o),(t instanceof URL||t.startsWith("file://"))&&(t=url.fileURLToPath(t));let h=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(h),this.#t=new ie,this.#s=new ie,this.#r=new Ie(r);let a=h.substring(this.rootPath.length).split(i);if(a.length===1&&!a[0]&&a.pop(),n===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=n,this.root=this.newRoot(this.#i),this.roots[this.rootPath]=this.root;let l=this.root,c=a.length-1,f=e.sep,u=this.rootPath,d=!1;for(let g of a){let p=c--;l=l.child(g,{relative:new Array(p).fill("..").join(f),relativePosix:new Array(p).fill("..").join("/"),fullpath:u+=(d?"":f)+g}),d=!0;}this.cwd=l;}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#r}resolve(...t){let e="";for(let r=t.length-1;r>=0;r--){let o=t[r];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#t.get(e);if(i!==void 0)return i;let n=this.cwd.resolve(e).fullpath();return this.#t.set(e,n),n}resolvePosix(...t){let e="";for(let r=t.length-1;r>=0;r--){let o=t[r];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let i=this.#s.get(e);if(i!==void 0)return i;let n=this.cwd.resolve(e).fullpathPosix();return this.#s.set(e,n),n}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i}=e;if(t.canReaddir()){let n=await t.readdir();return i?n:n.map(r=>r.name)}else return []}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0}=e;return t.canReaddir()?i?t.readdirSync():t.readdirSync().map(n=>n.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t.withFileTypes,t=this.cwd);let i=await t.readlink();return e?i:i?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t.withFileTypes,t=this.cwd);let i=t.readlinkSync();return e?i:i?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t.withFileTypes,t=this.cwd);let i=await t.realpath();return e?i:i?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t.withFileTypes,t=this.cwd);let i=t.realpathSync();return e?i:i?.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:n=!1,filter:r,walkFilter:o}=e,h=[];(!r||r(t))&&h.push(i?t:t.fullpath());let a=new Set,l=(f,u)=>{a.add(f),f.readdirCB((d,g)=>{if(d)return u(d);let p=g.length;if(!p)return u();let w=()=>{--p===0&&u();};for(let m of g)(!r||r(m))&&h.push(i?m:m.fullpath()),n&&m.isSymbolicLink()?m.realpath().then(b=>b?.isUnknown()?b.lstat():b).then(b=>b?.shouldWalk(a,o)?l(b,w):w()):m.shouldWalk(a,o)?l(m,w):w();},!0);},c=t;return new Promise((f,u)=>{l(c,d=>{if(d)return u(d);f(h);});})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:n=!1,filter:r,walkFilter:o}=e,h=[];(!r||r(t))&&h.push(i?t:t.fullpath());let a=new Set([t]);for(let l of a){let c=l.readdirSync();for(let f of c){(!r||r(f))&&h.push(i?f:f.fullpath());let u=f;if(f.isSymbolicLink()){if(!(n&&(u=f.realpathSync())))continue;u.isUnknown()&&u.lstatSync();}u.shouldWalk(a,o)&&a.add(u);}}return h}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:n=!1,filter:r,walkFilter:o}=e;(!r||r(t))&&(yield i?t:t.fullpath());let h=new Set([t]);for(let a of h){let l=a.readdirSync();for(let c of l){(!r||r(c))&&(yield i?c:c.fullpath());let f=c;if(c.isSymbolicLink()){if(!(n&&(f=c.realpathSync())))continue;f.isUnknown()&&f.lstatSync();}f.shouldWalk(h,o)&&h.add(f);}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:n=!1,filter:r,walkFilter:o}=e,h=new et({objectMode:!0});(!r||r(t))&&h.write(i?t:t.fullpath());let a=new Set,l=[t],c=0,f=()=>{let u=!1;for(;!u;){let d=l.shift();if(!d){c===0&&h.end();return}c++,a.add(d);let g=(w,m,b=!1)=>{if(w)return h.emit("error",w);if(n&&!b){let E=[];for(let y of m)y.isSymbolicLink()&&E.push(y.realpath().then(S=>S?.isUnknown()?S.lstat():S));if(E.length){Promise.all(E).then(()=>g(null,m,!0));return}}for(let E of m)E&&(!r||r(E))&&(h.write(i?E:E.fullpath())||(u=!0));c--;for(let E of m){let y=E.realpathCached()||E;y.shouldWalk(a,o)&&l.push(y);}u&&!h.flowing?h.once("drain",f):p||f();},p=!0;d.readdirCB(g,!0),p=!1;}};return f(),h}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof F||(e=t,t=this.cwd);let{withFileTypes:i=!0,follow:n=!1,filter:r,walkFilter:o}=e,h=new et({objectMode:!0}),a=new Set;(!r||r(t))&&h.write(i?t:t.fullpath());let l=[t],c=0,f=()=>{let u=!1;for(;!u;){let d=l.shift();if(!d){c===0&&h.end();return}c++,a.add(d);let g=d.readdirSync();for(let p of g)(!r||r(p))&&(h.write(i?p:p.fullpath())||(u=!0));c--;for(let p of g){let w=p;if(p.isSymbolicLink()){if(!(n&&(w=p.realpathSync())))continue;w.isUnknown()&&w.lstatSync();}w.shouldWalk(a,o)&&l.push(w);}}u&&!h.flowing&&h.once("drain",f);};return f(),h}chdir(t=this.cwd){let e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[ii](e);}},dt=class extends oe{sep="\\";constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,qe.win32,"\\",{...e,nocase:i}),this.nocase=i;for(let n=this.cwd;n;n=n.parent)n.nocase=this.nocase;}parseRootPath(t){return qe.win32.parse(t).root.toUpperCase()}newRoot(t){return new ne(this.rootPath,X,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}},pt=class extends oe{sep="/";constructor(t=process.cwd(),e={}){let{nocase:i=!1}=e;super(t,qe.posix,"/",{...e,nocase:i}),this.nocase=i;}parseRootPath(t){return "/"}newRoot(t){return new re(this.rootPath,X,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}},Pt=class extends pt{constructor(t=process.cwd(),e={}){let{nocase:i=!0}=e;super(t,{...e,nocase:i});}};process.platform==="win32"?ne:re;var ni=process.platform==="win32"?dt:process.platform==="darwin"?Pt:pt;var Wr=s=>s.length>=1,Br=s=>s.length>=1,gt=class s{#t;#s;#r;length;#i;#a;#l;#f;#h;#o;#e=!0;constructor(t,e,i,n){if(!Wr(t))throw new TypeError("empty pattern list");if(!Br(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,i<0||i>=this.length)throw new TypeError("index out of range");if(this.#t=t,this.#s=e,this.#r=i,this.#i=n,this.#r===0){if(this.isUNC()){let[r,o,h,a,...l]=this.#t,[c,f,u,d,...g]=this.#s;l[0]===""&&(l.shift(),g.shift());let p=[r,o,h,a,""].join("/"),w=[c,f,u,d,""].join("/");this.#t=[p,...l],this.#s=[w,...g],this.length=this.#t.length;}else if(this.isDrive()||this.isAbsolute()){let[r,...o]=this.#t,[h,...a]=this.#s;o[0]===""&&(o.shift(),a.shift());let l=r+"/",c=h+"/";this.#t=[l,...o],this.#s=[c,...a],this.length=this.#t.length;}}}pattern(){return this.#t[this.#r]}isString(){return typeof this.#t[this.#r]=="string"}isGlobstar(){return this.#t[this.#r]===k}isRegExp(){return this.#t[this.#r]instanceof RegExp}globString(){return this.#l=this.#l||(this.#r===0?this.isAbsolute()?this.#s[0]+this.#s.slice(1).join("/"):this.#s.join("/"):this.#s.slice(this.#r).join("/"))}hasMore(){return this.length>this.#r+1}rest(){return this.#a!==void 0?this.#a:this.hasMore()?(this.#a=new s(this.#t,this.#s,this.#r+1,this.#i),this.#a.#o=this.#o,this.#a.#h=this.#h,this.#a.#f=this.#f,this.#a):this.#a=null}isUNC(){let t=this.#t;return this.#h!==void 0?this.#h:this.#h=this.#i==="win32"&&this.#r===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3]}isDrive(){let t=this.#t;return this.#f!==void 0?this.#f:this.#f=this.#i==="win32"&&this.#r===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0])}isAbsolute(){let t=this.#t;return this.#o!==void 0?this.#o:this.#o=t[0]===""&&t.length>1||this.isDrive()||this.isUNC()}root(){let t=this.#t[0];return typeof t=="string"&&this.isAbsolute()&&this.#r===0?t:""}checkFollowGlobstar(){return !(this.#r===0||!this.isGlobstar()||!this.#e)}markFollowGlobstar(){return this.#r===0||!this.isGlobstar()||!this.#e?!1:(this.#e=!1,!0)}};var $r=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",Ft=class{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:i,noext:n,noglobstar:r,platform:o=$r}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];let h={dot:!0,nobrace:e,nocase:i,noext:n,noglobstar:r,optimizationLevel:2,platform:o,nocomment:!0,nonegate:!0};for(let a of t){let l=new L(a,h);for(let c=0;c<l.set.length;c++){let f=l.set[c],u=l.globParts[c];if(!f||!u)throw new Error("invalid pattern object");let d=new gt(f,u,0,o),g=new L(d.globString(),h),p=u[u.length-1]==="**",w=d.isAbsolute();w?this.absolute.push(g):this.relative.push(g),p&&(w?this.absoluteChildren.push(g):this.relativeChildren.push(g));}}}ignored(t){let e=t.fullpath(),i=`${e}/`,n=t.relative()||".",r=`${n}/`;for(let o of this.relative)if(o.match(n)||o.match(r))return !0;for(let o of this.absolute)if(o.match(e)||o.match(i))return !0;return !1}childrenIgnored(t){let e=t.fullpath()+"/",i=(t.relative()||".")+"/";for(let n of this.relativeChildren)if(n.match(i))return !0;for(let n of this.absoluteChildren)if(n.match(e))return !0;return !1}};var Me=class s{store;constructor(t=new Map){this.store=t;}copy(){return new s(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){let i=t.fullpath(),n=this.store.get(i);n?n.add(e.globString()):this.store.set(i,new Set([e.globString()]));}},Le=class{store=new Map;add(t,e,i){let n=(e?2:0)|(i?1:0),r=this.store.get(t);this.store.set(t,r===void 0?n:n&r);}entries(){return [...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}},je=class{store=new Map;add(t,e){if(!t.canReaddir())return;let i=this.store.get(t);i?i.find(n=>n.globString()===e.globString())||i.push(e):this.store.set(t,[e]);}get(t){let e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return [...this.store.keys()].filter(t=>t.canReaddir())}},Rt=class s{hasWalkedCache;matches=new Le;subwalks=new je;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new Me;}processPatterns(t,e){this.patterns=e;let i=e.map(n=>[t,n]);for(let[n,r]of i){this.hasWalkedCache.storeWalked(n,r);let o=r.root(),h=r.isAbsolute()&&this.opts.absolute!==!1;if(o){n=n.resolve(o==="/"&&this.opts.root!==void 0?this.opts.root:o);let f=r.rest();if(f)r=f;else {this.matches.add(n,!0,!1);continue}}if(n.isENOENT())continue;let a,l,c=!1;for(;typeof(a=r.pattern())=="string"&&(l=r.rest());)n=n.resolve(a),r=l,c=!0;if(a=r.pattern(),l=r.rest(),c){if(this.hasWalkedCache.hasWalked(n,r))continue;this.hasWalkedCache.storeWalked(n,r);}if(typeof a=="string"){let f=a===".."||a===""||a===".";this.matches.add(n.resolve(a),h,f);continue}else if(a===k){(!n.isSymbolicLink()||this.follow||r.checkFollowGlobstar())&&this.subwalks.add(n,r);let f=l?.pattern(),u=l?.rest();if(!l||(f===""||f===".")&&!u)this.matches.add(n,h,f===""||f===".");else if(f===".."){let d=n.parent||n;u?this.hasWalkedCache.hasWalked(d,u)||this.subwalks.add(d,u):this.matches.add(d,h,!0);}}else a instanceof RegExp&&this.subwalks.add(n,r);}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new s(this.opts,this.hasWalkedCache)}filterEntries(t,e){let i=this.subwalks.get(t),n=this.child();for(let r of e)for(let o of i){let h=o.isAbsolute(),a=o.pattern(),l=o.rest();a===k?n.testGlobstar(r,o,l,h):a instanceof RegExp?n.testRegExp(r,a,l,h):n.testString(r,a,l,h);}return n}testGlobstar(t,e,i,n){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,n,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(i&&e.checkFollowGlobstar()?this.subwalks.add(t,i):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),i){let r=i.pattern();if(typeof r=="string"&&r!==".."&&r!==""&&r!==".")this.testString(t,r,i.rest(),n);else if(r===".."){let o=t.parent||t;this.subwalks.add(o,i);}else r instanceof RegExp&&this.testRegExp(t,r,i.rest(),n);}}testRegExp(t,e,i,n){e.test(t.name)&&(i?this.subwalks.add(t,i):this.matches.add(t,n,!1));}testString(t,e,i,n){t.isNamed(e)&&(i?this.subwalks.add(t,i):this.matches.add(t,n,!1));}};var zr=(s,t)=>typeof s=="string"?new Ft([s],t):Array.isArray(s)?new Ft(s,t):s,ae=class{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#t=[];#s;#r;signal;maxDepth;constructor(t,e,i){this.patterns=t,this.path=e,this.opts=i,this.#r=!i.posix&&i.platform==="win32"?"\\":"/",i.ignore&&(this.#s=zr(i.ignore,i)),this.maxDepth=i.maxDepth||1/0,i.signal&&(this.signal=i.signal,this.signal.addEventListener("abort",()=>{this.#t.length=0;}));}#i(t){return this.seen.has(t)||!!this.#s?.ignored?.(t)}#a(t){return !!this.#s?.childrenIgnored?.(t)}pause(){this.paused=!0;}resume(){if(this.signal?.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=this.#t.shift());)t();}onResume(t){this.signal?.aborted||(this.paused?this.#t.push(t):t());}async matchCheck(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||await t.realpath(),!i)return;t=i;}let n=t.isUnknown()||this.opts.stat;return this.matchCheckTest(n?await t.lstat():t,e)}matchCheckTest(t,e){return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&!this.#i(t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let i;if(this.opts.realpath){if(i=t.realpathCached()||t.realpathSync(),!i)return;t=i;}let n=t.isUnknown()||this.opts.stat;return this.matchCheckTest(n?t.lstatSync():t,e)}matchFinish(t,e){if(this.#i(t))return;let i=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);let n=this.opts.mark&&t.isDirectory()?this.#r:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(i){let r=this.opts.posix?t.fullpathPosix():t.fullpath();this.matchEmit(r+n);}else {let r=this.opts.posix?t.relativePosix():t.relative(),o=this.opts.dotRelative&&!r.startsWith(".."+this.#r)?"."+this.#r:"";this.matchEmit(r?o+r+n:"."+n);}}async match(t,e,i){let n=await this.matchCheck(t,i);n&&this.matchFinish(n,e);}matchSync(t,e,i){let n=this.matchCheckSync(t,i);n&&this.matchFinish(n,e);}walkCB(t,e,i){this.signal?.aborted&&i(),this.walkCB2(t,e,new Rt(this.opts),i);}walkCB2(t,e,i,n){if(this.#a(t))return n();if(this.signal?.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2(t,e,i,n));return}i.processPatterns(t,e);let r=1,o=()=>{--r===0&&n();};for(let[h,a,l]of i.matches.entries())this.#i(h)||(r++,this.match(h,a,l).then(()=>o()));for(let h of i.subwalkTargets()){if(this.maxDepth!==1/0&&h.depth()>=this.maxDepth)continue;r++;let a=h.readdirCached();h.calledReaddir()?this.walkCB3(h,a,i,o):h.readdirCB((l,c)=>this.walkCB3(h,c,i,o),!0);}o();}walkCB3(t,e,i,n){i=i.filterEntries(t,e);let r=1,o=()=>{--r===0&&n();};for(let[h,a,l]of i.matches.entries())this.#i(h)||(r++,this.match(h,a,l).then(()=>o()));for(let[h,a]of i.subwalks.entries())r++,this.walkCB2(h,a,i.child(),o);o();}walkCBSync(t,e,i){this.signal?.aborted&&i(),this.walkCB2Sync(t,e,new Rt(this.opts),i);}walkCB2Sync(t,e,i,n){if(this.#a(t))return n();if(this.signal?.aborted&&n(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,i,n));return}i.processPatterns(t,e);let r=1,o=()=>{--r===0&&n();};for(let[h,a,l]of i.matches.entries())this.#i(h)||this.matchSync(h,a,l);for(let h of i.subwalkTargets()){if(this.maxDepth!==1/0&&h.depth()>=this.maxDepth)continue;r++;let a=h.readdirSync();this.walkCB3Sync(h,a,i,o);}o();}walkCB3Sync(t,e,i,n){i=i.filterEntries(t,e);let r=1,o=()=>{--r===0&&n();};for(let[h,a,l]of i.matches.entries())this.#i(h)||this.matchSync(h,a,l);for(let[h,a]of i.subwalks.entries())r++,this.walkCB2Sync(h,a,i.child(),o);o();}},It=class extends ae{matches;constructor(t,e,i){super(t,e,i),this.matches=new Set;}matchEmit(t){this.matches.add(t);}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((t,e)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches);});}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},Mt=class extends ae{results;constructor(t,e,i){super(t,e,i),this.results=new et({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume());}matchEmit(t){this.results.write(t),this.results.flowing||this.pause();}stream(){let t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end());}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var Gr=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",H=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(!e)throw new TypeError("glob options required");if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=url.fileURLToPath(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(a=>a.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(a=>a.includes("/")?a:`./**/${a}`);}if(this.pattern=t,this.platform=e.platform||Gr,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else {let a=e.platform==="win32"?dt:e.platform==="darwin"?Pt:e.platform?pt:ni;this.scurry=new a(this.cwd,{nocase:e.nocase,fs:e.fs});}this.nocase=this.scurry.nocase;let i=this.platform==="darwin"||this.platform==="win32",n={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:i,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},r=this.pattern.map(a=>new L(a,n)),[o,h]=r.reduce((a,l)=>(a[0].push(...l.set),a[1].push(...l.globParts),a),[[],[]]);this.patterns=o.map((a,l)=>{let c=h[l];if(!c)throw new Error("invalid pattern object");return new gt(a,c,0,this.platform)});}async walk(){return [...await new It(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return [...new It(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new Mt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new Mt(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var We=(s,t={})=>{Array.isArray(s)||(s=[s]);for(let e of s)if(new L(e,t).hasMagic())return !0;return !1};function le(s,t={}){return new H(s,t).streamSync()}function oi(s,t={}){return new H(s,t).stream()}function ai(s,t={}){return new H(s,t).walkSync()}async function ri(s,t={}){return new H(s,t).walk()}function ce(s,t={}){return new H(s,t).iterateSync()}function hi(s,t={}){return new H(s,t).iterate()}var Vr=le,Hr=Object.assign(oi,{sync:le}),Dr=ce,qr=Object.assign(hi,{sync:ce}),Xr=Object.assign(ai,{stream:le,iterate:ce}),he=Object.assign(ri,{glob:ri,globSync:ai,sync:Xr,globStream:oi,stream:Hr,globStreamSync:le,streamSync:Vr,globIterate:hi,iterate:qr,globIterateSync:ce,iterateSync:Dr,Glob:H,hasMagic:We,escape:ht,unescape:U});he.glob=he;var fi=(s,t)=>{let e={dirs:[],files:[]};return s.map(i=>qe.join(t,i)).forEach(i=>{(0, ci.default)(i)?e.files.push(...he.sync(i,{dot:!0,absolute:!0})):li__namespace.default.existsSync(i)?(li__namespace.default.lstatSync(i).isDirectory()?e.dirs:e.files).push(i):nodeLogger.logger.warn(N`
                    Ignoring additional watch path '${i}': path doesn't exists.
                `);}),e};var Lt="dev-preview-plugin",di=unplugin.createUnplugin(s=>{let{projectDir:t,additionalWatchPaths:e}=s;return {name:Lt,enforce:"post",transformInclude(i){return /storybook-config-entry\.js$/.test(i)},async transform(i){return N`
        import { symfonyPreview } from './symfony-preview.js';
        
        ${i}

        window.__SYMFONY_PREVIEW__ = symfonyPreview;
        if (import.meta.webpackHot) {
            import.meta.webpackHot.accept('./symfony-preview.js', () => {
                const iframe = window.top.document.getElementById('storybook-preview-iframe');
                if (iframe) {
                    iframe.src = iframe.src;
                }
            });
        }
        `},webpack(i){let n=new ui.default;n.apply(i);let r="";i.hooks.watchRun.tapPromise(Lt,async()=>{r=await Ut("storybook:generate-preview"),n.writeModule("./symfony-preview.js",N`
                    export const symfonyPreview = {
                        html: \`${r}\`,
                    };`);}),i.hooks.afterCompile.tap(Lt,o=>{if(o.name=="HtmlWebpackCompiler"){let h=fi(e,t);o.contextDependencies.addAll(h.dirs),o.fileDependencies.addAll(h.files);}}),i.hooks.thisCompilation.tap(Lt,o=>{hn__default.default.getHooks(o).afterTemplateExecution.tapPromise(Lt,async h=>{try{return h.html=Vt(r,h.html),h}catch(a){return nodeLogger.logger.error(N`
                            Failed to inject Symfony preview template in main iframe.html.
                            ERR: ${a}
                            `),h}});});}}});var Di=zt(Hi()),qi=s=>{let t=["block"],e=new RegExp(/twig:[A-Za-z]+(?::[A-Za-z]+)*/),i=new RegExp(/component\(\s*'([A-Za-z]+(?::[A-Za-z]+)*)'\s*(?:,.*)?\)/,"gs"),n=r=>Object.entries(r).reduce((o,[h,a])=>{if(a!==null&&typeof a=="object")o.push(...n(a));else if(typeof a=="string")for(let l of a.matchAll(i))o.push([...l][1]);return e.test(h)&&o.push(h.replace("twig:","")),o},[]);try{let r=new Di.XMLParser().parse(`<div>${s}</div>`);return n(r).filter(o=>!t.includes(o))}catch(r){throw new Error("Invalid XML.",{cause:{parserError:r,template:s}})}};var ue=class{constructor(t){this.config=t;}resolveNameFromFile(t){let e=(i,n)=>i.replace(n,"").replace(/^\//,"").replaceAll("/",":").replace(".html.twig","");for(let[i,n]of Object.entries(this.config.namespaces)){let r=n.find(o=>t.startsWith(o));if(r){let o=e(t,r);return i?`${i}:${o}`:o}}for(let i of this.config.anonymousTemplateDirectory)if(t.startsWith(i))return e(t,i);throw new Error(N`Unable to determine template name for file "${t}":`)}resolveFileFromName(t){let e=t.split(":"),i=e.length>1?e[0]:"",n=e.slice(0,-1),r=`${e.slice(-1)}.html.twig`,o=[];if(i&&this.config.namespaces[i]&&this.config.namespaces[i].length>0)for(let a of this.config.namespaces[i])o.push(qe__default.default.join(a,n.slice(1).join("/")));if(this.config.namespaces[""]&&this.config.namespaces[""].length>0)for(let h of this.config.namespaces[""])o.push(qe__default.default.join(h,n.join("/")));if(this.config.anonymousTemplateDirectory.length>0)for(let h of this.config.anonymousTemplateDirectory)o.push(qe__default.default.join(h,n.join("/")));try{return mt.resolve(`./${r}`,{paths:o})}catch(h){throw new Error(N`Unable to find template file for component "${t}": ${h}`)}}};var ua="twig-loader",Xi=unplugin.createUnplugin(s=>{let{twigComponentConfiguration:t}=s,e=new ue(t);return {name:ua,enforce:"pre",transformInclude:i=>/\.html\.twig$/.test(i),transform:async(i,n)=>{let r=[];try{new Set(qi(i)).forEach(a=>{r.push(e.resolveFileFromName(a));});}catch(h){nodeLogger.logger.warn(N`
                Failed to parse template in '${n}': ${h}
                `);}let o=e.resolveNameFromFile(n);return N`
            ${r.map(h=>`import '${h}';`).join(`
`)}
            export default {
                name: \'${o}\',
                hash: \`${fa__default.default.createHash("sha1").update(i).digest("hex")}\`,
            };
           `}}});var da=async s=>{let t=await Ze(),e=await Qe(),i=await ts(),n={},r=Object.keys(i.paths).map(a=>`${t}/${a}/`);for(let{name_prefix:a,template_directory:l}of Object.values(e.defaults))n[a]=r.map(c=>qe.join(c,l));let o=r.map(a=>qe.join(a,e.anonymous_template_directory)),h=(await Je()).runtime_dir;return {twigComponent:{anonymousTemplateDirectory:o,namespaces:n},twig:{paths:r},runtimeDir:h,projectDir:t,additionalWatchPaths:s.additionalWatchPaths||[]}},Pl=async(s,t)=>{let e=await t.presets.apply("framework"),i=typeof e=="string"?{}:e.options,n=await da(i.symfony);return {...s,plugins:[...s.plugins||[],t.configType==="PRODUCTION"?es.webpack():di.webpack({projectDir:n.projectDir,additionalWatchPaths:n.additionalWatchPaths}),Xi.webpack({twigComponentConfiguration:n.twigComponent,twigConfiguration:n.twig})],module:{...s.module,rules:[...s.module?.rules||[]]}}},Fl=async s=>N`
    ${s}
    <!--PREVIEW_HEAD_PLACEHOLDER-->
    `,Rl=async s=>N`
    ${s}
    <!--PREVIEW_BODY_PLACEHOLDER-->
    `;/*! Bundled license information:

is-extglob/index.js:
  (*!
   * is-extglob <https://github.com/jonschlinkert/is-extglob>
   *
   * Copyright (c) 2014-2016, Jon Schlinkert.
   * Licensed under the MIT License.
   *)

is-glob/index.js:
  (*!
   * is-glob <https://github.com/jonschlinkert/is-glob>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/

exports.previewBody = Rl;
exports.previewHead = Fl;
exports.webpack = Pl;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=framework-preset.js.map